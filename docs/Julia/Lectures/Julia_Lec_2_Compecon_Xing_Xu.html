<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CompEconUMN2024 - Lecture 2: A canonical Neo-classical growth model and introduction to value function iteration (VFI)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">CompEconUMN2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-julia-lectures" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Julia Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-julia-lectures">    
        <li>
    <a class="dropdown-item" href="../../Julia/Lectures/Julia_Lec_1_Compecon_Xing_Xu.html">
 <span class="dropdown-text">Lecture 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Julia/Lectures/Julia_Lec_2_Compecon_Xing_Xu.html">
 <span class="dropdown-text">Lecture 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Julia/Lectures/Julia_Lec_3_Compecon_Xing_Xu.html">
 <span class="dropdown-text">Lecture 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Julia/Lectures/Julia_Lec_4_Compecon_Xing_Xu.html">
 <span class="dropdown-text">Lecture 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Julia/Lectures/Julia_Lec_5_Compecon_Xing_Xu.html">
 <span class="dropdown-text">Lecture 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Julia/Lectures/Julia_Lec_6_Compecon_Xing_Xu.html">
 <span class="dropdown-text">Lecture 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-python-lectures" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Python Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-python-lectures">    
        <li>
    <a class="dropdown-item" href="../../Python/Lectures/lecture1.html">
 <span class="dropdown-text">Lecture 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Python/Lectures/lecture2.html">
 <span class="dropdown-text">Lecture 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Python/Lectures/lecture3.html">
 <span class="dropdown-text">Lecture 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Python/Lectures/lecture4.html">
 <span class="dropdown-text">Lecture 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Python/Lectures/lecture5.html">
 <span class="dropdown-text">Lecture 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-julia-assignments" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Julia Assignments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-julia-assignments">    
        <li>
    <a class="dropdown-item" href="../../Julia/Assignments/Julia_PS_1_Compecon_Xing_Xu.html">
 <span class="dropdown-text">Assignment 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Julia/Assignments/Julia_PS_2_Compecon_Xing_Xu.html">
 <span class="dropdown-text">Assignment 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#a-canonical-neo-classical-growth-model" id="toc-a-canonical-neo-classical-growth-model" class="nav-link active" data-scroll-target="#a-canonical-neo-classical-growth-model">2.1 A canonical Neo-classical growth model</a></li>
  <li><a href="#introduction-to-value-function-iteration-vfi" id="toc-introduction-to-value-function-iteration-vfi" class="nav-link" data-scroll-target="#introduction-to-value-function-iteration-vfi">2.3 Introduction to value function iteration (VFI)</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">2.5 Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lecture 2: A canonical Neo-classical growth model and introduction to value function iteration (VFI)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Xing Xu, University of Minnesota, 2023 Summer</em></p>
<section id="a-canonical-neo-classical-growth-model" class="level3">
<h3 class="anchored" data-anchor-id="a-canonical-neo-classical-growth-model">2.1 A canonical Neo-classical growth model</h3>
<section id="environment" class="level4">
<h4 class="anchored" data-anchor-id="environment">2.1.1 Environment</h4>
<p>An economy is composed of</p>
<ul>
<li><p>An infinitely lived representative household whose preferences are represented by a utility function <span class="math inline">\(u(c) = \sum_{t=0}^\infty \beta^t u(c_t)\)</span>, where <span class="math inline">\(\beta \in (0, 1)\)</span> is the discount factor. The household inelastically supplies 1 unit of labor each period.</p></li>
<li><p>A firm with technology <span class="math inline">\(y_t = F(k_t, l_t)\)</span>. That is, for each period, firm transforms current capital stock and labor supply into <span class="math inline">\(y_t\)</span> units of goods.</p></li>
<li><p>Standard law of motion for investment holds: <span class="math inline">\(x_t = k_{t+1} - (1 - \delta) k_t\)</span>, where <span class="math inline">\(\delta_t \in (0, 1]\)</span> is the depreciation factor.</p></li>
<li><p>The initial capital stock <span class="math inline">\(k_0\)</span> is given.</p></li>
</ul>
<p>Therefore, total feasibility constraint for the economy is thus <span class="math inline">\(c_t + x_t \leq F(k_t, l_t), \forall t\)</span>, which is equivalent to <span class="math inline">\(c_t + k_{t+1} \leq F(k_t, l_t) + (1 - \delta) k_t, \forall t\)</span>.</p>
</section>
<section id="social-planners-problem" class="level4">
<h4 class="anchored" data-anchor-id="social-planners-problem">2.1.2 Social Planner’s problem</h4>
<p>Under some assumptions, we can use the <strong>social planner’s problem</strong> to characterize the Pareto Optimal allocations (<span class="math inline">\(l_t = 1\)</span> substituted in): <span class="math display">\[\begin{align*}
    \max_{\{c_t, k_{t+1}\}_{t=0}^\infty} &amp;\sum_{t=0}^\infty \beta^t u(c_t) \\
    \text{subject to } &amp; c_t + k_{t+1} \leq F(k_t, 1) + (1 - \delta) k_t, \forall t\\
    c_t, k_{t+1} \geq 0, \forall t,  &amp; \quad k_0 \text{ given }
\end{align*}\]</span></p>
</section>
<section id="question-how-to-solve-this" class="level4">
<h4 class="anchored" data-anchor-id="question-how-to-solve-this">2.1.3 Question: how to solve this?</h4>
<p>For simplicity, let’s assume utility is CRRA: <span class="math inline">\(u(c_t) = \frac{c_t^{1 - \sigma}}{1 - \sigma}\)</span> (<span class="math inline">\(\sigma &gt; 0, \sigma \neq 1\)</span>) and production function is Cobb-Douglas: <span class="math inline">\(F(k_t, l_t) = A k_t^\alpha l_t^{1-\alpha}\)</span>. Now intuitively, we have a strictly concave function maximizing on a convex set, which should give unique solution to the maximization problem (not rigid).</p>
<p>One attempt is to set up Lagrangian and take first order conditions (by Inada condition we know the solution is interior): <span class="math display">\[
\begin{cases}
\beta^t c_t^{-\sigma} = \lambda_t\\
\lambda_t = \lambda_{t+1}(A \alpha k_{t+1}^{\alpha - 1} + (1 - \delta) )\\
\end{cases}
\]</span></p>
<p>which gives the famous Euler Equation, <span class="math display">\[
c_t^{-\sigma} = \beta c_{t+1}^{-\sigma}(A \alpha k_{t+1}^{\alpha - 1} + (1 - \delta) )
\]</span></p>
<p>Assume there’s a steady state where <span class="math inline">\(c_t\)</span> and <span class="math inline">\(k_t\)</span> converges to some constants <span class="math inline">\(c_{ss}\)</span> and <span class="math inline">\(k_{ss}\)</span>, when <span class="math inline">\(t\)</span> is large enough. From the Euler equation, in steady state: <span class="math display">\[
1 = \beta (A \alpha k_{ss}^{\alpha - 1} + (1 - \delta) )
\]</span></p>
<p>Side note: In a competitive equilibrium, this condition becomes <span class="math inline">\(\beta R = 1\)</span> or <span class="math inline">\(R = \frac{1}{\beta}\)</span>, which is the equilibrium interest rate in a complete market.</p>
<p>The Euler Equation characterizes the intertemporal optimality. Together with the feasiblity constraint (<em>and for technical reasons, a transversality condition</em> <span class="math inline">\(\lim_{t \to \infty} \lambda_t k_{t+1} = 0\)</span>), the equilibrium is characterized. We end up with infinite amount of unknowns <span class="math inline">\(\{c_t, k_{t+1}\}_{t=0}^\infty\)</span> and equal amounts of equations, which is troublesome to solve. This is why we turn to dynamic programming.</p>
<hr>
<p>Now, denote the lifetime discounted utility of the social planner’s problem given initial capital stock <span class="math inline">\(k_0\)</span> as <span class="math inline">\(V(k_0)\)</span>, so</p>
<p><span class="math display">\[\begin{align*}
    V(k_0) \equiv \max_{\{c_t, k_{t+1}\}_{t=0}^\infty} &amp; \sum_{t=0}^\infty \beta^t u(c_t) \\
    \text{subject to } c_t + k_{t+1} &amp;\leq F(k_t, 1) + (1 - \delta) k_t, \forall t\\
    c_t, k_{t+1} \geq 0, \forall t,  &amp; \quad k_0 \text{ given }
\end{align*}\]</span></p>
<p>Let be maximizer be some feasible optimal plan <span class="math inline">\(\{c_t, k_{t+1}\}_{t=0}^\infty\)</span> such that <span class="math inline">\(c_t + k_{t+1} \leq F(k_t, 1) + (1 - \delta) k_t, \forall t\)</span> and <span class="math inline">\(c_t, k_{t+1} \geq 0\)</span>.</p>
<p>Now let’s turn to the recursive formulation of the problem.</p>
</section>
<section id="bellmans-equation" class="level4">
<h4 class="anchored" data-anchor-id="bellmans-equation">2.2.1 Bellman’s Equation</h4>
<p>Under some conditions, the social planner’s problem is equivalent to the following problem, which is in the form of a Bellman’s Equation:</p>
<p><span class="math display">\[\begin{align*}
    V(k) = &amp; \max_{c, k'} \{u(c) + \beta V(k') \}\\
    \text{subject to } &amp; c + k' \leq F(k, 1) + (1 - \delta) k\\
    &amp; c , k' \geq 0
\end{align*}\]</span></p>
<p>We call <span class="math inline">\(V\)</span> as the value function. Under some conditions, the solution to this problem <span class="math inline">\(c\)</span> and <span class="math inline">\(k'\)</span> are functions of <span class="math inline">\(k\)</span>, and are denoted as <span class="math inline">\(g_c(k)\)</span> and <span class="math inline">\(g(k)\)</span>. From <span class="math inline">\(k_0\)</span>, iteratively applying the policy function of capital, we obtain <span class="math inline">\(k_1 = g(k_0)\)</span>, <span class="math inline">\(k_2 = g(g(k_0))\)</span>, …, which is the optimal plan of capital. Also iteratively applying the consumption policy function, <span class="math inline">\(c_0 = g_c(k_0)\)</span>, <span class="math inline">\(c_1 = g_c(k_1)\)</span>, …. Collecting the terms, we have constructed the optimal plan from <span class="math inline">\(k_0\)</span>, <span class="math inline">\(\{c_t, k_{t+1}\}_{t=0}^\infty\)</span>.</p>
<p>Note that we have turned a infinite horizon problem into a single period problem. Equivalence between the recursive formulation with the social planner’s problem is in the sense of <span class="math inline">\(V(.)\)</span> being the same function and the optimal plans generated from a same <span class="math inline">\(k\)</span> is the same. This is the Principle of Optimality. (SLP Theorem 4.2 to 4.5)</p>
<p>With the assumption that <span class="math inline">\(u(.)\)</span> is strictly increasing, for any <span class="math inline">\(k\)</span> and <span class="math inline">\(k'\)</span>, <span class="math inline">\(g_c(k) = F(k, 1) + (1 - \delta) k - k'\)</span>, substitute in, the problem becomes</p>
<p><span class="math display">\[
V(k) =  \max_{k' \in \Gamma(k)} \{u(F(k, 1) + (1 - \delta) k - k') + \beta V(k')\}
\]</span> where <span class="math inline">\(\Gamma(k) \equiv [0, F(k, 1) + (1 - \delta) k]\)</span></p>
</section>
<section id="contraction-mapping" class="level4">
<h4 class="anchored" data-anchor-id="contraction-mapping">2.2.2 Contraction mapping</h4>
<p>Define a Bellman operator <span class="math inline">\(T\)</span> as follows, <span class="math display">\[
T(V)(k) = \max_{k' \in \Gamma(k)} \{u(F(k, 1) + (1 - \delta) k - k') + \beta V(k')\}
\]</span> The solution to the Bellman’s equation is a fixed point such that <span class="math inline">\(T(V^*) = V^*\)</span>.</p>
</section>
<section id="blackwells-sufficient-condition" class="level4">
<h4 class="anchored" data-anchor-id="blackwells-sufficient-condition">2.2.3 Blackwell’s sufficient condition</h4>
<p><span class="math inline">\(K \subset R^n\)</span>. The Bellman Operator <span class="math inline">\(T\)</span> maps <span class="math inline">\(B(K) \to B(K)\)</span>, where <span class="math inline">\(B(K)\)</span> is the set of bounded functions <span class="math inline">\(V: K \to R\)</span>. Suppose <span class="math inline">\(T\)</span> satisfies: * Monotonicity: if <span class="math inline">\(W(k) \geq V(k)\)</span>, for all <span class="math inline">\(k \in K\)</span>, where <span class="math inline">\(V, W \in B(K)\)</span>, then <span class="math inline">\(T(W)(k) \geq T(V)(k)\)</span>. * Discounting: there exists <span class="math inline">\(\beta, 1&gt; \beta &gt;0\)</span>, such that, <span class="math inline">\(T(V+a)(k) \leq T(V)(k) + \beta a\)</span> for all <span class="math inline">\(V \in B(K), a \geq 0\)</span> and <span class="math inline">\(k \in K\)</span>.</p>
<p>Then <span class="math inline">\(T\)</span> is a contraction with modulus <span class="math inline">\(\beta\)</span>. That is, <span class="math inline">\(|| T(V) - T(W) || \leq \beta ||V -W ||\)</span>.</p>
<p>This implies that if we iteratively apply <span class="math inline">\(T\)</span> on <span class="math inline">\(V\)</span>, the solution converges to the fixed point <span class="math inline">\(V^*\)</span>. This process is known as value function iteration.</p>
<p>Sketch of proof: to show that in our environment <span class="math inline">\(T\)</span> maps a bounded function into a bounded function requires showing there is a maximum sustainable capital <span class="math inline">\(\tilde{k}\)</span> such that <span class="math inline">\(\forall k &gt; \tilde{k}, F(k, 1) &lt; \delta k\)</span>. <span class="math inline">\(\tilde{k}\)</span> is given by <span class="math inline">\(F(\tilde{k}, 1) = \delta \tilde{k}\)</span> (why?). Then it is easy to show that Monotonicity and Discounting hold. (equivalently one can use SLP Theorem 4.6)</p>
<p>Now before coding it, initialize an environment.</p>
<div id="cell-6" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Pkg</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(<span class="pp">@__DIR__</span>)  <span class="co"># Activate a local environment </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">"LinearAlgebra"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  Activating project at `~/Documents/Teaching/Julia course 2024/Julia/Lectures`
    Updating registry at `~/.julia/registries/General.toml`
   Resolving package versions...
  No Changes to `~/Documents/Teaching/Julia course 2024/Julia/Lectures/Project.toml`
  No Changes to `~/Documents/Teaching/Julia course 2024/Julia/Lectures/Manifest.toml`</code></pre>
</div>
</div>
<div id="cell-7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="introduction-to-value-function-iteration-vfi" class="level3">
<h3 class="anchored" data-anchor-id="introduction-to-value-function-iteration-vfi">2.3 Introduction to value function iteration (VFI)</h3>
<p>Finally we get to business. First we need to specify a set of parameters.</p>
<p>Let household has CRRA utility with <span class="math inline">\(\sigma = 2\)</span> and <span class="math inline">\(\beta = 0.9\)</span>. Firm has Cobb-Douglas utility with <span class="math inline">\(A = 2\)</span>, <span class="math inline">\(\alpha = 0.7\)</span>. <span class="math inline">\(\delta = 0.9\)</span>.</p>
<section id="vfi-a-first-attempt-bad-practice-inefficient-and-poorly-written" class="level5">
<h5 class="anchored" data-anchor-id="vfi-a-first-attempt-bad-practice-inefficient-and-poorly-written">2.3.1 VFI: A first attempt (bad practice: inefficient and poorly written)</h5>
<p>Let’s first just go with instinct. Set up the problem with the parameters and solve it. If you have experience with this, you might find the codes a little Matlab or c++ styled. We will turn to more Julia styled codes later.</p>
<p>First, specify parameters:</p>
<div id="cell-9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>σ <span class="op">=</span> <span class="fl">2.0</span> <span class="co">#make it float to keep consistent with other variables</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>β <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>α <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>δ <span class="op">=</span> <span class="fl">0.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.9</code></pre>
</div>
</div>
<p>Initialize grid of <span class="math inline">\(v\)</span>. Let there be 100 grids.</p>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="fl">100</span> <span class="co"># number of grids</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> <span class="fu">zeros</span>(N); <span class="co">#initial guess of value function v(k), here just 0.0 for any k</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to create grids for <span class="math inline">\(k\)</span> and <span class="math inline">\(k'\)</span>. To do this, we need the maximum sustainable capital. Note that <span class="math inline">\(\tilde{k}\)</span> can be solved from <span class="math inline">\(F(\tilde{k}, 1) = \delta \tilde{k}\)</span>, which is <span class="math inline">\(A \tilde{k}^\alpha = \delta \tilde{k}\)</span>. Since <span class="math inline">\(\delta &gt; 0\)</span>, <span class="math inline">\(\tilde{k} = (\frac{A}{\delta})^{\frac{1}{1 - \alpha}}\)</span>.</p>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>k_tilde <span class="op">=</span> (A <span class="op">/</span> δ)<span class="op">^</span>(<span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> α))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0.01</span>, k_tilde, N) <span class="co">#Note that the grids for k' is same as k</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># start with 0.01 as for k = 0, consumption will always be 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.01:0.14455054028788528:14.320503488500643</code></pre>
</div>
</div>
<p>Now let’s perform VFI. I wrap VFI into a function, which takes in the parameters and spits out the value function and policy function.</p>
<p>I set a small enough tolerance of error so that the value function is considered as converged when the maximum absolute difference between each iteration is below the critical tolerance (here <span class="math inline">\(10^{-6}\)</span>). In addition, I set a maximum iteration 1000 so that it will terminate even if it does not converge.</p>
<div id="cell-15" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VFI (bad practice)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VFI_baseline</span>(σ, β, A, α, δ, v, k)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    pol <span class="op">=</span> <span class="fu">similar</span>(v, <span class="dt">Int</span>) <span class="co"># will be used for storing the policy function (k'), as an index</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for storing updated value function</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    iterate <span class="op">=</span> <span class="fl">0</span> <span class="co"># keep track of how many iterations we have run</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-6</span> <span class="co"># the critical tolerance</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="cn">true</span> <span class="co"># the code keeps iterating itself until we manually break it</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used to keep track of the difference between v and Tv</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># outer loop over each grid of v</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(v) <span class="co"># iterate over value function</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            pol_i <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            just_started <span class="op">=</span> <span class="cn">true</span>  <span class="co"># will be used later to store v with choosing k'= 0</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            vmax <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used later to store the maximized v</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># most inner loop over potential k'</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="fu">eachindex</span>(k) </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> A <span class="op">*</span> k[i]<span class="op">^</span>α <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> δ) <span class="op">*</span> k[i] <span class="op">-</span> k[j] <span class="co"># this is the consumption if we choose k' = k[j]</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;=</span> <span class="fl">0.0</span> <span class="co"># make sure consumption is nonnegative</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                    v_tmp <span class="op">=</span> c<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> σ) <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> σ) <span class="op">+</span> β <span class="op">*</span> v[j] <span class="co">#v if choosing k' = k[j]</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> just_started <span class="co"># logic operation </span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp <span class="co"># store the value function</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j <span class="co"># store the policy function (an index on k)</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                        just_started <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elseif</span> v_tmp <span class="op">&gt;</span> vmax </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">end</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            v1[i] <span class="op">=</span> vmax <span class="co">#update maximized value</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            pol[i] <span class="op">=</span> pol_i <span class="co">#update policy function</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> distance <span class="op">&lt;</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i])</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                distance <span class="op">=</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i]) <span class="co">#update distance</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        (distance <span class="op">&lt;</span> tol <span class="op">||</span> iterate <span class="op">==</span> <span class="fl">1000</span>) <span class="op">&amp;&amp;</span> <span class="cf">break</span> <span class="co"># break out the whole loop if one of the statements are true</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        iterate <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        v<span class="op">.=</span> v1<span class="co"># update the value, equivalently v = copy(v1)</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v<span class="op">=</span>v, pol<span class="op">=</span>pol, iterate<span class="op">=</span>iterate)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>VFI_baseline (generic function with 1 method)</code></pre>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(v, pol, iterate) <span class="op">=</span>  <span class="fu">VFI_baseline</span>(σ, β, A, α, δ, v, k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-141.6000605365398, -13.982081957061373, -11.222006674686714, -9.97467946907761, -9.194802019095095, -8.641506656983273, -8.23605937587854, -7.9187196210739685, -7.662167409250431, -7.446410754534364  …  -4.775705127339619, -4.7678914912950106, -4.760029024037419, -4.752245655402492, -4.744586503571926, -4.736843187659619, -4.7292611942669005, -4.721836140169183, -4.714354354769835, -4.707224761555834], pol = [1, 3, 4, 5, 6, 8, 9, 10, 11, 12  …  68, 68, 69, 70, 71, 71, 72, 72, 73, 73], iterate = 157)</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"The value function converged in </span><span class="sc">$</span>iterate<span class="st"> loops"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The value function converged in 157 loops</code></pre>
</div>
</div>
<p>Let’s see how the value function and the policy function look like. For this purpose, we need an additional package.</p>
<div id="cell-19" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">"Plots"</span>) <span class="co"># This takes a while</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>   Resolving package versions...
   Installed PlotThemes ───────── v3.2.0
   Installed TranscodingStreams ─ v0.10.9
   Installed LogExpFunctions ──── v0.3.28
    Updating `~/Documents/Teaching/Julia course 2024/Julia/Lectures/Project.toml`
  [91a5bcdd] + Plots v1.40.4
    Updating `~/Documents/Teaching/Julia course 2024/Julia/Lectures/Manifest.toml`
  [d1d4a3ce] + BitFlags v0.1.8
  [944b1d66] + CodecZlib v0.7.4
  [35d6a980] + ColorSchemes v3.25.0
  [3da002f7] + ColorTypes v0.11.5
  [c3611d14] + ColorVectorSpace v0.10.0
  [5ae59095] + Colors v0.12.11
  [34da2185] + Compat v4.15.0
  [f0e56b4a] + ConcurrentUtilities v2.4.1
  [d38c429a] + Contour v0.6.3
  [9a962f9c] + DataAPI v1.16.0
  [864edb3b] + DataStructures v0.18.20
  [8bb1440f] + DelimitedFiles v1.9.1
  [ffbed154] + DocStringExtensions v0.9.3
  [460bff9d] + ExceptionUnwrapping v0.1.10
  [c87230d0] + FFMPEG v0.4.1
  [53c48c17] + FixedPointNumbers v0.8.5
  [1fa38f19] + Format v1.3.7
  [28b8d3ca] + GR v0.73.5
  [42e2da0e] + Grisu v1.0.2
  [cd3eb016] + HTTP v1.10.8
  [92d709cd] + IrrationalConstants v0.2.2
  [1019f520] + JLFzf v0.1.7
  [692b3bcd] + JLLWrappers v1.5.0
  [682c06a0] + JSON v0.21.4
  [b964fa9f] + LaTeXStrings v1.3.1
  [23fbe1c1] + Latexify v0.16.3
  [2ab3a3ac] + LogExpFunctions v0.3.28
  [e6f89c97] + LoggingExtras v1.0.3
  [1914dd2f] + MacroTools v0.5.13
  [739be429] + MbedTLS v1.1.9
  [442fdcdd] + Measures v0.3.2
  [e1d29d7a] + Missings v1.2.0
  [77ba4419] + NaNMath v1.0.2
  [4d8831e6] + OpenSSL v1.4.3
  [bac558e1] + OrderedCollections v1.6.3
  [69de0a69] + Parsers v2.8.1
  [b98c9c47] + Pipe v1.3.0
  [ccf2f8ad] + PlotThemes v3.2.0
  [995b91a9] + PlotUtils v1.4.1
  [91a5bcdd] + Plots v1.40.4
  [aea7be01] + PrecompileTools v1.2.1
  [21216c6a] + Preferences v1.4.3
  [3cdcf5f2] + RecipesBase v1.3.4
  [01d81517] + RecipesPipeline v0.6.12
  [189a3867] + Reexport v1.2.2
  [05181044] + RelocatableFolders v1.0.1
  [ae029012] + Requires v1.3.0
  [6c6a2e73] + Scratch v1.2.1
  [992d4aef] + Showoff v1.0.3
  [777ac1f9] + SimpleBufferStream v1.1.0
  [a2af1166] + SortingAlgorithms v1.2.1
  [82ae8749] + StatsAPI v1.7.0
  [2913bbd2] + StatsBase v0.34.3
  [62fd8b95] + TensorCore v0.1.1
  [3bb67fe8] + TranscodingStreams v0.10.9
  [5c2747f8] + URIs v1.5.1
  [1cfade01] + UnicodeFun v0.4.1
  [1986cc42] + Unitful v1.20.0
  [45397f5d] + UnitfulLatexify v1.6.3
  [41fe7b60] + Unzip v0.2.0
  [6e34b625] + Bzip2_jll v1.0.8+1
  [83423d85] + Cairo_jll v1.18.0+2
  [2702e6a9] + EpollShim_jll v0.0.20230411+0
  [2e619515] + Expat_jll v2.6.2+0
⌅ [b22a6f82] + FFMPEG_jll v4.4.4+1
  [a3f928ae] + Fontconfig_jll v2.13.96+0
  [d7e528f0] + FreeType2_jll v2.13.2+0
  [559328eb] + FriBidi_jll v1.0.14+0
  [0656b61e] + GLFW_jll v3.3.9+0
  [d2c73de3] + GR_jll v0.73.5+0
  [78b55507] + Gettext_jll v0.21.0+0
  [7746bdde] + Glib_jll v2.80.2+0
  [3b182d85] + Graphite2_jll v1.3.14+0
  [2e76f6c2] + HarfBuzz_jll v2.8.1+1
  [aacddb02] + JpegTurbo_jll v3.0.3+0
  [c1c5ebd0] + LAME_jll v3.100.2+0
⌅ [88015f11] + LERC_jll v3.0.0+1
  [1d63c593] + LLVMOpenMP_jll v15.0.7+0
  [dd4b983a] + LZO_jll v2.10.2+0
⌅ [e9f186c6] + Libffi_jll v3.2.2+1
  [d4300ac3] + Libgcrypt_jll v1.8.11+0
  [7e76a0d4] + Libglvnd_jll v1.6.0+0
  [7add5ba3] + Libgpg_error_jll v1.49.0+0
  [94ce4f54] + Libiconv_jll v1.17.0+0
  [4b2f31a3] + Libmount_jll v2.40.1+0
⌅ [89763e89] + Libtiff_jll v4.5.1+1
  [38a345b3] + Libuuid_jll v2.40.1+0
  [e7412a2a] + Ogg_jll v1.3.5+1
  [458c3c95] + OpenSSL_jll v3.0.13+1
  [91d4177d] + Opus_jll v1.3.2+0
  [30392449] + Pixman_jll v0.43.4+0
⌅ [c0090381] + Qt6Base_jll v6.5.3+1
  [a44049a8] + Vulkan_Loader_jll v1.3.243+0
  [a2964d1f] + Wayland_jll v1.21.0+1
  [2381bf8a] + Wayland_protocols_jll v1.31.0+0
  [02c8fc9c] + XML2_jll v2.12.7+0
  [aed1982a] + XSLT_jll v1.1.34+0
  [ffd25f8a] + XZ_jll v5.4.6+0
  [f67eecfb] + Xorg_libICE_jll v1.1.1+0
  [c834827a] + Xorg_libSM_jll v1.2.4+0
  [4f6342f7] + Xorg_libX11_jll v1.8.6+0
  [0c0b7dd1] + Xorg_libXau_jll v1.0.11+0
  [935fb764] + Xorg_libXcursor_jll v1.2.0+4
  [a3789734] + Xorg_libXdmcp_jll v1.1.4+0
  [1082639a] + Xorg_libXext_jll v1.3.6+0
  [d091e8ba] + Xorg_libXfixes_jll v5.0.3+4
  [a51aa0fd] + Xorg_libXi_jll v1.7.10+4
  [d1454406] + Xorg_libXinerama_jll v1.1.4+4
  [ec84b674] + Xorg_libXrandr_jll v1.5.2+4
  [ea2f1a96] + Xorg_libXrender_jll v0.9.11+0
  [14d82f49] + Xorg_libpthread_stubs_jll v0.1.1+0
  [c7cfdc94] + Xorg_libxcb_jll v1.15.0+0
  [cc61e674] + Xorg_libxkbfile_jll v1.1.2+0
  [e920d4aa] + Xorg_xcb_util_cursor_jll v0.1.4+0
  [12413925] + Xorg_xcb_util_image_jll v0.4.0+1
  [2def613f] + Xorg_xcb_util_jll v0.4.0+1
  [975044d2] + Xorg_xcb_util_keysyms_jll v0.4.0+1
  [0d47668e] + Xorg_xcb_util_renderutil_jll v0.3.9+1
  [c22f9ab0] + Xorg_xcb_util_wm_jll v0.4.1+1
  [35661453] + Xorg_xkbcomp_jll v1.4.6+0
  [33bec58e] + Xorg_xkeyboard_config_jll v2.39.0+0
  [c5fb5394] + Xorg_xtrans_jll v1.5.0+0
  [3161d3a3] + Zstd_jll v1.5.6+0
  [35ca27e7] + eudev_jll v3.2.9+0
⌅ [214eeab7] + fzf_jll v0.43.0+0
  [1a1c6b14] + gperf_jll v3.1.1+0
  [a4ae2306] + libaom_jll v3.9.0+0
  [0ac62f75] + libass_jll v0.15.1+0
  [2db6ffa8] + libevdev_jll v1.11.0+0
  [f638f0a6] + libfdk_aac_jll v2.0.2+0
  [36db933b] + libinput_jll v1.18.0+0
  [b53b4c65] + libpng_jll v1.6.43+1
  [f27f6e37] + libvorbis_jll v1.3.7+1
  [009596ad] + mtdev_jll v1.1.6+0
  [1270edf5] + x264_jll v2021.5.5+0
  [dfaa095f] + x265_jll v3.5.0+0
  [d8fb68d0] + xkbcommon_jll v1.4.1+1
  [0dad84c5] + ArgTools v1.1.1
  [2a0f44e3] + Base64
  [ade2ca70] + Dates
  [f43a241f] + Downloads v1.6.0
  [7b1f6079] + FileWatching
  [b77e0a4c] + InteractiveUtils
  [b27032c2] + LibCURL v0.6.3
  [76f85450] + LibGit2
  [56ddb016] + Logging
  [d6f4376e] + Markdown
  [a63ad114] + Mmap
  [ca575930] + NetworkOptions v1.2.0
  [44cfe95a] + Pkg v1.9.2
  [de0858da] + Printf
  [3fa0cd96] + REPL
  [9a3f8284] + Random
  [ea8e919c] + SHA v0.7.0
  [9e88b42a] + Serialization
  [6462fe0b] + Sockets
  [2f01184e] + SparseArrays
  [10745b16] + Statistics v1.9.0
  [fa267f1f] + TOML v1.0.3
  [a4e569a6] + Tar v1.10.0
  [8dfed614] + Test
  [cf7118a7] + UUIDs
  [4ec0a83e] + Unicode
  [deac9b47] + LibCURL_jll v7.84.0+0
  [29816b5a] + LibSSH2_jll v1.10.2+0
  [c8ffd9c3] + MbedTLS_jll v2.28.2+0
  [14a3606d] + MozillaCACerts_jll v2022.10.11
  [05823500] + OpenLibm_jll v0.8.1+0
  [efcefdf7] + PCRE2_jll v10.42.0+0
  [bea87d4a] + SuiteSparse_jll v5.10.1+6
  [83775a58] + Zlib_jll v1.2.13+0
  [8e850ede] + nghttp2_jll v1.48.0+0
  [3f19e933] + p7zip_jll v17.4.0+0
        Info Packages marked with ⌅ have new versions available but compatibility constraints restrict them from upgrading. To see why use `status --outdated -m`
Precompiling project...
  ✓ LogExpFunctions
  ✓ TranscodingStreams
  ✓ TranscodingStreams → TestExt
  ✓ CodecZlib
  ✓ PlotThemes
  ✓ StatsBase
  ✓ HTTP
  ✓ GR
  ✓ Plots
  ✓ Plots → UnitfulExt
  10 dependencies successfully precompiled in 47 seconds. 138 already precompiled.</code></pre>
</div>
</div>
<div id="cell-20" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span> <span class="co"># this also might take some time</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-21" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">v_plot</span>(k, v)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    Plots.<span class="fu">plot</span>(k, v, primary<span class="op">=</span><span class="cn">false</span>, xlabel <span class="op">=</span> <span class="st">"Current capital, k "</span>, ylabel <span class="op">=</span> <span class="st">"Value function, v"</span>, linewidth<span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">v_plot</span>(k, v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewbox="0 0 2400 1600">
<defs>
  <clippath id="clip570">
    <rect x="0" y="0" width="2400" height="1600"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip570)" d="M0 1600 L2400 1600 L2400 8.88178e-14 L0 8.88178e-14  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip571">
    <rect x="480" y="0" width="1681" height="1600"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip570)" d="M272.297 1423.18 L2352.76 1423.18 L2352.76 47.2441 L272.297 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip572">
    <rect x="272" y="47" width="2081" height="1377"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="329.806,1423.18 329.806,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="741.258,1423.18 741.258,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1152.71,1423.18 1152.71,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1564.16,1423.18 1564.16,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1975.62,1423.18 1975.62,47.2441 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="272.297,1423.18 2352.76,1423.18 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="329.806,1423.18 329.806,1404.28 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="741.258,1423.18 741.258,1404.28 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1152.71,1423.18 1152.71,1404.28 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1564.16,1423.18 1564.16,1404.28 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1975.62,1423.18 1975.62,1404.28 "></polyline>
<path clip-path="url(#clip570)" d="M329.806 1454.1 Q326.195 1454.1 324.366 1457.66 Q322.561 1461.2 322.561 1468.33 Q322.561 1475.44 324.366 1479.01 Q326.195 1482.55 329.806 1482.55 Q333.44 1482.55 335.246 1479.01 Q337.074 1475.44 337.074 1468.33 Q337.074 1461.2 335.246 1457.66 Q333.44 1454.1 329.806 1454.1 M329.806 1450.39 Q335.616 1450.39 338.672 1455 Q341.75 1459.58 341.75 1468.33 Q341.75 1477.06 338.672 1481.67 Q335.616 1486.25 329.806 1486.25 Q323.996 1486.25 320.917 1481.67 Q317.862 1477.06 317.862 1468.33 Q317.862 1459.58 320.917 1455 Q323.996 1450.39 329.806 1450.39 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M745.506 1466.95 Q748.863 1467.66 750.738 1469.93 Q752.636 1472.2 752.636 1475.53 Q752.636 1480.65 749.117 1483.45 Q745.599 1486.25 739.117 1486.25 Q736.941 1486.25 734.627 1485.81 Q732.335 1485.39 729.881 1484.54 L729.881 1480.02 Q731.826 1481.16 734.14 1481.74 Q736.455 1482.32 738.978 1482.32 Q743.377 1482.32 745.668 1480.58 Q747.983 1478.84 747.983 1475.53 Q747.983 1472.48 745.83 1470.77 Q743.701 1469.03 739.881 1469.03 L735.853 1469.03 L735.853 1465.19 L740.066 1465.19 Q743.515 1465.19 745.344 1463.82 Q747.173 1462.43 747.173 1459.84 Q747.173 1457.18 745.275 1455.77 Q743.4 1454.33 739.881 1454.33 Q737.96 1454.33 735.761 1454.75 Q733.562 1455.16 730.923 1456.04 L730.923 1451.88 Q733.585 1451.14 735.9 1450.77 Q738.238 1450.39 740.298 1450.39 Q745.622 1450.39 748.724 1452.83 Q751.826 1455.23 751.826 1459.35 Q751.826 1462.22 750.182 1464.21 Q748.539 1466.18 745.506 1466.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1153.12 1466.44 Q1149.97 1466.44 1148.12 1468.59 Q1146.29 1470.74 1146.29 1474.49 Q1146.29 1478.22 1148.12 1480.39 Q1149.97 1482.55 1153.12 1482.55 Q1156.26 1482.55 1158.09 1480.39 Q1159.94 1478.22 1159.94 1474.49 Q1159.94 1470.74 1158.09 1468.59 Q1156.26 1466.44 1153.12 1466.44 M1162.4 1451.78 L1162.4 1456.04 Q1160.64 1455.21 1158.83 1454.77 Q1157.05 1454.33 1155.29 1454.33 Q1150.66 1454.33 1148.21 1457.45 Q1145.78 1460.58 1145.43 1466.9 Q1146.8 1464.89 1148.86 1463.82 Q1150.92 1462.73 1153.39 1462.73 Q1158.6 1462.73 1161.61 1465.9 Q1164.64 1469.05 1164.64 1474.49 Q1164.64 1479.82 1161.5 1483.03 Q1158.35 1486.25 1153.12 1486.25 Q1147.12 1486.25 1143.95 1481.67 Q1140.78 1477.06 1140.78 1468.33 Q1140.78 1460.14 1144.67 1455.28 Q1148.56 1450.39 1155.11 1450.39 Q1156.87 1450.39 1158.65 1450.74 Q1160.45 1451.09 1162.4 1451.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1554.46 1484.86 L1554.46 1480.6 Q1556.22 1481.44 1558.03 1481.88 Q1559.83 1482.32 1561.57 1482.32 Q1566.2 1482.32 1568.63 1479.21 Q1571.08 1476.09 1571.43 1469.75 Q1570.09 1471.74 1568.03 1472.8 Q1565.97 1473.87 1563.47 1473.87 Q1558.28 1473.87 1555.25 1470.74 Q1552.24 1467.59 1552.24 1462.15 Q1552.24 1456.83 1555.39 1453.61 Q1558.54 1450.39 1563.77 1450.39 Q1569.77 1450.39 1572.91 1455 Q1576.08 1459.58 1576.08 1468.33 Q1576.08 1476.51 1572.2 1481.39 Q1568.33 1486.25 1561.78 1486.25 Q1560.02 1486.25 1558.21 1485.9 Q1556.41 1485.56 1554.46 1484.86 M1563.77 1470.21 Q1566.92 1470.21 1568.75 1468.06 Q1570.6 1465.9 1570.6 1462.15 Q1570.6 1458.43 1568.75 1456.27 Q1566.92 1454.1 1563.77 1454.1 Q1560.62 1454.1 1558.77 1456.27 Q1556.94 1458.43 1556.94 1462.15 Q1556.94 1465.9 1558.77 1468.06 Q1560.62 1470.21 1563.77 1470.21 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1951.1 1481.64 L1958.74 1481.64 L1958.74 1455.28 L1950.43 1456.95 L1950.43 1452.69 L1958.69 1451.02 L1963.37 1451.02 L1963.37 1481.64 L1971.01 1481.64 L1971.01 1485.58 L1951.1 1485.58 L1951.1 1481.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1984.48 1481.64 L2000.8 1481.64 L2000.8 1485.58 L1978.86 1485.58 L1978.86 1481.64 Q1981.52 1478.89 1986.1 1474.26 Q1990.71 1469.61 1991.89 1468.27 Q1994.13 1465.74 1995.01 1464.01 Q1995.92 1462.25 1995.92 1460.56 Q1995.92 1457.8 1993.97 1456.07 Q1992.05 1454.33 1988.95 1454.33 Q1986.75 1454.33 1984.3 1455.09 Q1981.87 1455.86 1979.09 1457.41 L1979.09 1452.69 Q1981.91 1451.55 1984.37 1450.97 Q1986.82 1450.39 1988.86 1450.39 Q1994.23 1450.39 1997.42 1453.08 Q2000.62 1455.77 2000.62 1460.26 Q2000.62 1462.39 1999.81 1464.31 Q1999.02 1466.2 1996.91 1468.8 Q1996.33 1469.47 1993.23 1472.69 Q1990.13 1475.88 1984.48 1481.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1060.51 1524.18 L1060.51 1530.96 Q1057.26 1527.94 1053.57 1526.44 Q1049.91 1524.95 1045.77 1524.95 Q1037.62 1524.95 1033.29 1529.95 Q1028.97 1534.91 1028.97 1544.33 Q1028.97 1553.72 1033.29 1558.72 Q1037.62 1563.68 1045.77 1563.68 Q1049.91 1563.68 1053.57 1562.19 Q1057.26 1560.69 1060.51 1557.67 L1060.51 1564.38 Q1057.13 1566.68 1053.35 1567.82 Q1049.59 1568.97 1045.39 1568.97 Q1034.6 1568.97 1028.39 1562.38 Q1022.19 1555.76 1022.19 1544.33 Q1022.19 1532.87 1028.39 1526.28 Q1034.6 1519.66 1045.39 1519.66 Q1049.65 1519.66 1053.41 1520.81 Q1057.2 1521.92 1060.51 1524.18 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1069.58 1553.98 L1069.58 1532.4 L1075.44 1532.4 L1075.44 1553.75 Q1075.44 1558.81 1077.41 1561.36 Q1079.38 1563.87 1083.33 1563.87 Q1088.07 1563.87 1090.81 1560.85 Q1093.58 1557.83 1093.58 1552.61 L1093.58 1532.4 L1099.43 1532.4 L1099.43 1568.04 L1093.58 1568.04 L1093.58 1562.57 Q1091.45 1565.82 1088.61 1567.41 Q1085.81 1568.97 1082.09 1568.97 Q1075.94 1568.97 1072.76 1565.15 Q1069.58 1561.33 1069.58 1553.98 M1084.32 1531.54 L1084.32 1531.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1132.15 1537.87 Q1131.17 1537.3 1129.99 1537.04 Q1128.84 1536.76 1127.44 1536.76 Q1122.48 1536.76 1119.8 1540 Q1117.16 1543.22 1117.16 1549.27 L1117.16 1568.04 L1111.27 1568.04 L1111.27 1532.4 L1117.16 1532.4 L1117.16 1537.93 Q1119.01 1534.69 1121.97 1533.13 Q1124.93 1531.54 1129.16 1531.54 Q1129.77 1531.54 1130.5 1531.63 Q1131.23 1531.7 1132.12 1531.85 L1132.15 1537.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1157.81 1537.87 Q1156.82 1537.3 1155.64 1537.04 Q1154.5 1536.76 1153.1 1536.76 Q1148.13 1536.76 1145.46 1540 Q1142.82 1543.22 1142.82 1549.27 L1142.82 1568.04 L1136.93 1568.04 L1136.93 1532.4 L1142.82 1532.4 L1142.82 1537.93 Q1144.66 1534.69 1147.62 1533.13 Q1150.58 1531.54 1154.82 1531.54 Q1155.42 1531.54 1156.15 1531.63 Q1156.88 1531.7 1157.78 1531.85 L1157.81 1537.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1193.01 1548.76 L1193.01 1551.62 L1166.08 1551.62 Q1166.47 1557.67 1169.71 1560.85 Q1172.99 1564 1178.81 1564 Q1182.19 1564 1185.34 1563.17 Q1188.52 1562.35 1191.64 1560.69 L1191.64 1566.23 Q1188.49 1567.57 1185.18 1568.27 Q1181.87 1568.97 1178.46 1568.97 Q1169.93 1568.97 1164.94 1564 Q1159.97 1559.04 1159.97 1550.57 Q1159.97 1541.82 1164.68 1536.69 Q1169.43 1531.54 1177.45 1531.54 Q1184.64 1531.54 1188.81 1536.18 Q1193.01 1540.8 1193.01 1548.76 M1187.15 1547.04 Q1187.09 1542.23 1184.45 1539.37 Q1181.84 1536.5 1177.51 1536.5 Q1172.61 1536.5 1169.65 1539.27 Q1166.72 1542.04 1166.27 1547.07 L1187.15 1547.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1232.25 1546.53 L1232.25 1568.04 L1226.4 1568.04 L1226.4 1546.72 Q1226.4 1541.66 1224.42 1539.14 Q1222.45 1536.63 1218.5 1536.63 Q1213.76 1536.63 1211.03 1539.65 Q1208.29 1542.68 1208.29 1547.9 L1208.29 1568.04 L1202.4 1568.04 L1202.4 1532.4 L1208.29 1532.4 L1208.29 1537.93 Q1210.39 1534.72 1213.22 1533.13 Q1216.09 1531.54 1219.81 1531.54 Q1225.95 1531.54 1229.1 1535.36 Q1232.25 1539.14 1232.25 1546.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1249.73 1522.27 L1249.73 1532.4 L1261.79 1532.4 L1261.79 1536.95 L1249.73 1536.95 L1249.73 1556.3 Q1249.73 1560.66 1250.91 1561.9 Q1252.12 1563.14 1255.78 1563.14 L1261.79 1563.14 L1261.79 1568.04 L1255.78 1568.04 Q1249 1568.04 1246.42 1565.53 Q1243.84 1562.98 1243.84 1556.3 L1243.84 1536.95 L1239.54 1536.95 L1239.54 1532.4 L1243.84 1532.4 L1243.84 1522.27 L1249.73 1522.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1315.87 1533.76 L1315.87 1539.24 Q1313.39 1537.87 1310.87 1537.2 Q1308.39 1536.5 1305.84 1536.5 Q1300.14 1536.5 1296.99 1540.13 Q1293.84 1543.73 1293.84 1550.25 Q1293.84 1556.78 1296.99 1560.4 Q1300.14 1564 1305.84 1564 Q1308.39 1564 1310.87 1563.33 Q1313.39 1562.63 1315.87 1561.26 L1315.87 1566.68 Q1313.42 1567.82 1310.78 1568.39 Q1308.17 1568.97 1305.21 1568.97 Q1297.15 1568.97 1292.41 1563.91 Q1287.67 1558.85 1287.67 1550.25 Q1287.67 1541.53 1292.44 1536.53 Q1297.25 1531.54 1305.59 1531.54 Q1308.29 1531.54 1310.87 1532.11 Q1313.45 1532.65 1315.87 1533.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1342.25 1550.12 Q1335.16 1550.12 1332.42 1551.75 Q1329.68 1553.37 1329.68 1557.29 Q1329.68 1560.4 1331.72 1562.25 Q1333.79 1564.07 1337.32 1564.07 Q1342.19 1564.07 1345.12 1560.63 Q1348.08 1557.16 1348.08 1551.43 L1348.08 1550.12 L1342.25 1550.12 M1353.94 1547.71 L1353.94 1568.04 L1348.08 1568.04 L1348.08 1562.63 Q1346.07 1565.88 1343.08 1567.44 Q1340.09 1568.97 1335.76 1568.97 Q1330.29 1568.97 1327.04 1565.91 Q1323.83 1562.82 1323.83 1557.67 Q1323.83 1551.65 1327.84 1548.6 Q1331.88 1545.54 1339.87 1545.54 L1348.08 1545.54 L1348.08 1544.97 Q1348.08 1540.93 1345.41 1538.73 Q1342.76 1536.5 1337.96 1536.5 Q1334.9 1536.5 1332.01 1537.23 Q1329.11 1537.97 1326.44 1539.43 L1326.44 1534.02 Q1329.65 1532.78 1332.67 1532.17 Q1335.7 1531.54 1338.56 1531.54 Q1346.3 1531.54 1350.12 1535.55 Q1353.94 1539.56 1353.94 1547.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1371.66 1562.7 L1371.66 1581.6 L1365.78 1581.6 L1365.78 1532.4 L1371.66 1532.4 L1371.66 1537.81 Q1373.51 1534.62 1376.31 1533.1 Q1379.14 1531.54 1383.06 1531.54 Q1389.55 1531.54 1393.59 1536.69 Q1397.67 1541.85 1397.67 1550.25 Q1397.67 1558.65 1393.59 1563.81 Q1389.55 1568.97 1383.06 1568.97 Q1379.14 1568.97 1376.31 1567.44 Q1373.51 1565.88 1371.66 1562.7 M1391.59 1550.25 Q1391.59 1543.79 1388.91 1540.13 Q1386.27 1536.44 1381.63 1536.44 Q1376.98 1536.44 1374.31 1540.13 Q1371.66 1543.79 1371.66 1550.25 Q1371.66 1556.71 1374.31 1560.4 Q1376.98 1564.07 1381.63 1564.07 Q1386.27 1564.07 1388.91 1560.4 Q1391.59 1556.71 1391.59 1550.25 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1407.38 1532.4 L1413.23 1532.4 L1413.23 1568.04 L1407.38 1568.04 L1407.38 1532.4 M1407.38 1518.52 L1413.23 1518.52 L1413.23 1525.93 L1407.38 1525.93 L1407.38 1518.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1431.28 1522.27 L1431.28 1532.4 L1443.34 1532.4 L1443.34 1536.95 L1431.28 1536.95 L1431.28 1556.3 Q1431.28 1560.66 1432.46 1561.9 Q1433.67 1563.14 1437.33 1563.14 L1443.34 1563.14 L1443.34 1568.04 L1437.33 1568.04 Q1430.55 1568.04 1427.97 1565.53 Q1425.39 1562.98 1425.39 1556.3 L1425.39 1536.95 L1421.09 1536.95 L1421.09 1532.4 L1425.39 1532.4 L1425.39 1522.27 L1431.28 1522.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1467.24 1550.12 Q1460.15 1550.12 1457.41 1551.75 Q1454.67 1553.37 1454.67 1557.29 Q1454.67 1560.4 1456.71 1562.25 Q1458.78 1564.07 1462.31 1564.07 Q1467.18 1564.07 1470.11 1560.63 Q1473.07 1557.16 1473.07 1551.43 L1473.07 1550.12 L1467.24 1550.12 M1478.93 1547.71 L1478.93 1568.04 L1473.07 1568.04 L1473.07 1562.63 Q1471.06 1565.88 1468.07 1567.44 Q1465.08 1568.97 1460.75 1568.97 Q1455.28 1568.97 1452.03 1565.91 Q1448.82 1562.82 1448.82 1557.67 Q1448.82 1551.65 1452.83 1548.6 Q1456.87 1545.54 1464.86 1545.54 L1473.07 1545.54 L1473.07 1544.97 Q1473.07 1540.93 1470.4 1538.73 Q1467.75 1536.5 1462.95 1536.5 Q1459.89 1536.5 1457 1537.23 Q1454.1 1537.97 1451.43 1539.43 L1451.43 1534.02 Q1454.64 1532.78 1457.66 1532.17 Q1460.69 1531.54 1463.55 1531.54 Q1471.29 1531.54 1475.11 1535.55 Q1478.93 1539.56 1478.93 1547.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1490.99 1518.52 L1496.85 1518.52 L1496.85 1568.04 L1490.99 1568.04 L1490.99 1518.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1510.6 1559.96 L1517.31 1559.96 L1517.31 1565.43 L1512.09 1575.62 L1507.99 1575.62 L1510.6 1565.43 L1510.6 1559.96 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1550.32 1518.52 L1556.21 1518.52 L1556.21 1547.77 L1573.68 1532.4 L1581.16 1532.4 L1562.25 1549.07 L1581.95 1568.04 L1574.32 1568.04 L1556.21 1550.63 L1556.21 1568.04 L1550.32 1568.04 L1550.32 1518.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="272.297,1226.83 2352.76,1226.83 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="272.297,989.776 2352.76,989.776 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="272.297,752.72 2352.76,752.72 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="272.297,515.663 2352.76,515.663 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="272.297,278.607 2352.76,278.607 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="272.297,1423.18 272.297,47.2441 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="272.297,1226.83 291.194,1226.83 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="272.297,989.776 291.194,989.776 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="272.297,752.72 291.194,752.72 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="272.297,515.663 291.194,515.663 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="272.297,278.607 291.194,278.607 "></polyline>
<path clip-path="url(#clip570)" d="M115.256 1227.28 L144.931 1227.28 L144.931 1231.22 L115.256 1231.22 L115.256 1227.28 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M155.834 1240.18 L163.473 1240.18 L163.473 1213.81 L155.163 1215.48 L155.163 1211.22 L163.427 1209.55 L168.102 1209.55 L168.102 1240.18 L175.741 1240.18 L175.741 1244.11 L155.834 1244.11 L155.834 1240.18 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M189.213 1240.18 L205.533 1240.18 L205.533 1244.11 L183.588 1244.11 L183.588 1240.18 Q186.251 1237.42 190.834 1232.79 Q195.44 1228.14 196.621 1226.8 Q198.866 1224.27 199.746 1222.54 Q200.649 1220.78 200.649 1219.09 Q200.649 1216.33 198.704 1214.6 Q196.783 1212.86 193.681 1212.86 Q191.482 1212.86 189.028 1213.63 Q186.598 1214.39 183.82 1215.94 L183.82 1211.22 Q186.644 1210.08 189.098 1209.51 Q191.551 1208.93 193.588 1208.93 Q198.959 1208.93 202.153 1211.61 Q205.348 1214.3 205.348 1218.79 Q205.348 1220.92 204.537 1222.84 Q203.75 1224.74 201.644 1227.33 Q201.065 1228 197.963 1231.22 Q194.862 1234.41 189.213 1240.18 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M215.394 1209.55 L233.75 1209.55 L233.75 1213.49 L219.676 1213.49 L219.676 1221.96 Q220.695 1221.61 221.713 1221.45 Q222.732 1221.27 223.75 1221.27 Q229.537 1221.27 232.917 1224.44 Q236.297 1227.61 236.297 1233.02 Q236.297 1238.6 232.824 1241.7 Q229.352 1244.78 223.033 1244.78 Q220.857 1244.78 218.588 1244.41 Q216.343 1244.04 213.936 1243.3 L213.936 1238.6 Q216.019 1239.74 218.241 1240.29 Q220.463 1240.85 222.94 1240.85 Q226.945 1240.85 229.283 1238.74 Q231.621 1236.64 231.621 1233.02 Q231.621 1229.41 229.283 1227.31 Q226.945 1225.2 222.94 1225.2 Q221.065 1225.2 219.19 1225.62 Q217.338 1226.03 215.394 1226.91 L215.394 1209.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M114.26 990.227 L143.936 990.227 L143.936 994.162 L114.26 994.162 L114.26 990.227 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M154.839 1003.12 L162.477 1003.12 L162.477 976.755 L154.167 978.422 L154.167 974.163 L162.431 972.496 L167.107 972.496 L167.107 1003.12 L174.746 1003.12 L174.746 1007.06 L154.839 1007.06 L154.839 1003.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M194.19 975.575 Q190.579 975.575 188.75 979.139 Q186.945 982.681 186.945 989.811 Q186.945 996.917 188.75 1000.48 Q190.579 1004.02 194.19 1004.02 Q197.825 1004.02 199.63 1000.48 Q201.459 996.917 201.459 989.811 Q201.459 982.681 199.63 979.139 Q197.825 975.575 194.19 975.575 M194.19 971.871 Q200 971.871 203.056 976.477 Q206.135 981.061 206.135 989.811 Q206.135 998.537 203.056 1003.14 Q200 1007.73 194.19 1007.73 Q188.38 1007.73 185.301 1003.14 Q182.246 998.537 182.246 989.811 Q182.246 981.061 185.301 976.477 Q188.38 971.871 194.19 971.871 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M224.352 975.575 Q220.741 975.575 218.912 979.139 Q217.107 982.681 217.107 989.811 Q217.107 996.917 218.912 1000.48 Q220.741 1004.02 224.352 1004.02 Q227.986 1004.02 229.792 1000.48 Q231.621 996.917 231.621 989.811 Q231.621 982.681 229.792 979.139 Q227.986 975.575 224.352 975.575 M224.352 971.871 Q230.162 971.871 233.218 976.477 Q236.297 981.061 236.297 989.811 Q236.297 998.537 233.218 1003.14 Q230.162 1007.73 224.352 1007.73 Q218.542 1007.73 215.463 1003.14 Q212.408 998.537 212.408 989.811 Q212.408 981.061 215.463 976.477 Q218.542 971.871 224.352 971.871 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M145.417 753.171 L175.093 753.171 L175.093 757.106 L145.417 757.106 L145.417 753.171 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M184.005 735.44 L206.227 735.44 L206.227 737.43 L193.681 770 L188.797 770 L200.602 739.375 L184.005 739.375 L184.005 735.44 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M215.394 735.44 L233.75 735.44 L233.75 739.375 L219.676 739.375 L219.676 747.847 Q220.695 747.5 221.713 747.338 Q222.732 747.152 223.75 747.152 Q229.537 747.152 232.917 750.324 Q236.297 753.495 236.297 758.912 Q236.297 764.49 232.824 767.592 Q229.352 770.671 223.033 770.671 Q220.857 770.671 218.588 770.301 Q216.343 769.93 213.936 769.189 L213.936 764.49 Q216.019 765.625 218.241 766.18 Q220.463 766.736 222.94 766.736 Q226.945 766.736 229.283 764.629 Q231.621 762.523 231.621 758.912 Q231.621 755.301 229.283 753.194 Q226.945 751.088 222.94 751.088 Q221.065 751.088 219.19 751.504 Q217.338 751.921 215.394 752.801 L215.394 735.44 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M144.422 516.115 L174.098 516.115 L174.098 520.05 L144.422 520.05 L144.422 516.115 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M184.237 498.383 L202.593 498.383 L202.593 502.318 L188.519 502.318 L188.519 510.791 Q189.538 510.443 190.556 510.281 Q191.575 510.096 192.593 510.096 Q198.38 510.096 201.76 513.267 Q205.139 516.439 205.139 521.855 Q205.139 527.434 201.667 530.536 Q198.195 533.615 191.875 533.615 Q189.7 533.615 187.431 533.244 Q185.186 532.874 182.778 532.133 L182.778 527.434 Q184.862 528.568 187.084 529.124 Q189.306 529.679 191.783 529.679 Q195.787 529.679 198.125 527.573 Q200.463 525.466 200.463 521.855 Q200.463 518.244 198.125 516.138 Q195.787 514.031 191.783 514.031 Q189.908 514.031 188.033 514.448 Q186.181 514.865 184.237 515.744 L184.237 498.383 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M224.352 501.462 Q220.741 501.462 218.912 505.027 Q217.107 508.568 217.107 515.698 Q217.107 522.804 218.912 526.369 Q220.741 529.911 224.352 529.911 Q227.986 529.911 229.792 526.369 Q231.621 522.804 231.621 515.698 Q231.621 508.568 229.792 505.027 Q227.986 501.462 224.352 501.462 M224.352 497.758 Q230.162 497.758 233.218 502.365 Q236.297 506.948 236.297 515.698 Q236.297 524.425 233.218 529.031 Q230.162 533.615 224.352 533.615 Q218.542 533.615 215.463 529.031 Q212.408 524.425 212.408 515.698 Q212.408 506.948 215.463 502.365 Q218.542 497.758 224.352 497.758 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M145.417 279.058 L175.093 279.058 L175.093 282.993 L145.417 282.993 L145.417 279.058 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M189.213 291.952 L205.533 291.952 L205.533 295.887 L183.588 295.887 L183.588 291.952 Q186.251 289.197 190.834 284.568 Q195.44 279.915 196.621 278.572 Q198.866 276.049 199.746 274.313 Q200.649 272.554 200.649 270.864 Q200.649 268.109 198.704 266.373 Q196.783 264.637 193.681 264.637 Q191.482 264.637 189.028 265.401 Q186.598 266.165 183.82 267.716 L183.82 262.994 Q186.644 261.859 189.098 261.281 Q191.551 260.702 193.588 260.702 Q198.959 260.702 202.153 263.387 Q205.348 266.072 205.348 270.563 Q205.348 272.693 204.537 274.614 Q203.75 276.512 201.644 279.105 Q201.065 279.776 197.963 282.993 Q194.862 286.188 189.213 291.952 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M215.394 261.327 L233.75 261.327 L233.75 265.262 L219.676 265.262 L219.676 273.734 Q220.695 273.387 221.713 273.225 Q222.732 273.04 223.75 273.04 Q229.537 273.04 232.917 276.211 Q236.297 279.382 236.297 284.799 Q236.297 290.378 232.824 293.48 Q229.352 296.558 223.033 296.558 Q220.857 296.558 218.588 296.188 Q216.343 295.817 213.936 295.077 L213.936 290.378 Q216.019 291.512 218.241 292.067 Q220.463 292.623 222.94 292.623 Q226.945 292.623 229.283 290.517 Q231.621 288.41 231.621 284.799 Q231.621 281.188 229.283 279.081 Q226.945 276.975 222.94 276.975 Q221.065 276.975 219.19 277.392 Q217.338 277.808 215.394 278.688 L215.394 261.327 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M64.0042 988.854 L16.4842 1007 L16.4842 1000.28 L56.4926 985.225 L16.4842 970.138 L16.4842 963.454 L64.0042 981.565 L64.0042 988.854 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M46.0847 945.63 Q46.0847 952.728 47.7079 955.465 Q49.3312 958.203 53.2461 958.203 Q56.3653 958.203 58.2114 956.166 Q60.0256 954.097 60.0256 950.564 Q60.0256 945.694 56.5881 942.766 Q53.1188 939.806 47.3897 939.806 L46.0847 939.806 L46.0847 945.63 M43.6657 933.949 L64.0042 933.949 L64.0042 939.806 L58.5933 939.806 Q61.8398 941.811 63.3994 944.803 Q64.9272 947.795 64.9272 952.123 Q64.9272 957.598 61.8716 960.844 Q58.7843 964.059 53.6281 964.059 Q47.6125 964.059 44.5569 960.049 Q41.5014 956.007 41.5014 948.018 L41.5014 939.806 L40.9285 939.806 Q36.8862 939.806 34.6901 942.479 Q32.4621 945.121 32.4621 949.927 Q32.4621 952.983 33.1941 955.879 Q33.9262 958.776 35.3903 961.449 L29.9795 961.449 Q28.7381 958.235 28.1334 955.211 Q27.4968 952.187 27.4968 949.323 Q27.4968 941.588 31.5072 937.769 Q35.5176 933.949 43.6657 933.949 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M14.479 921.886 L14.479 916.03 L64.0042 916.03 L64.0042 921.886 L14.479 921.886 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M49.9359 904.381 L28.3562 904.381 L28.3562 898.524 L49.7131 898.524 Q54.7739 898.524 57.3202 896.551 Q59.8346 894.577 59.8346 890.631 Q59.8346 885.888 56.8109 883.151 Q53.7872 880.382 48.5673 880.382 L28.3562 880.382 L28.3562 874.525 L64.0042 874.525 L64.0042 880.382 L58.5296 880.382 Q61.7762 882.514 63.3676 885.347 Q64.9272 888.148 64.9272 891.872 Q64.9272 898.015 61.1078 901.198 Q57.2883 904.381 49.9359 904.381 M27.4968 889.644 L27.4968 889.644 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M44.7161 831.971 L47.5806 831.971 L47.5806 858.898 Q53.6281 858.516 56.8109 855.269 Q59.9619 851.991 59.9619 846.166 Q59.9619 842.792 59.1344 839.641 Q58.3069 836.459 56.6518 833.339 L62.1899 833.339 Q63.5267 836.49 64.227 839.801 Q64.9272 843.111 64.9272 846.516 Q64.9272 855.046 59.9619 860.043 Q54.9967 865.009 46.5303 865.009 Q37.7774 865.009 32.6531 860.298 Q27.4968 855.556 27.4968 847.535 Q27.4968 840.342 32.1438 836.172 Q36.7589 831.971 44.7161 831.971 M42.9973 837.827 Q38.1912 837.891 35.3266 840.533 Q32.4621 843.143 32.4621 847.471 Q32.4621 852.373 35.2312 855.333 Q38.0002 858.261 43.0292 858.707 L42.9973 837.827 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M14.479 783.591 L19.3487 783.591 L19.3487 789.193 Q19.3487 792.344 20.6219 793.585 Q21.895 794.795 25.2052 794.795 L28.3562 794.795 L28.3562 785.151 L32.9077 785.151 L32.9077 794.795 L64.0042 794.795 L64.0042 800.683 L32.9077 800.683 L32.9077 806.285 L28.3562 806.285 L28.3562 800.683 L25.8736 800.683 Q19.9216 800.683 17.2162 797.914 Q14.479 795.145 14.479 789.13 L14.479 783.591 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M49.9359 779.294 L28.3562 779.294 L28.3562 773.438 L49.7131 773.438 Q54.7739 773.438 57.3202 771.465 Q59.8346 769.491 59.8346 765.545 Q59.8346 760.802 56.8109 758.065 Q53.7872 755.296 48.5673 755.296 L28.3562 755.296 L28.3562 749.439 L64.0042 749.439 L64.0042 755.296 L58.5296 755.296 Q61.7762 757.428 63.3676 760.261 Q64.9272 763.062 64.9272 766.786 Q64.9272 772.929 61.1078 776.112 Q57.2883 779.294 49.9359 779.294 M27.4968 764.558 L27.4968 764.558 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M42.4881 707.744 L64.0042 707.744 L64.0042 713.6 L42.679 713.6 Q37.6183 713.6 35.1038 715.574 Q32.5894 717.547 32.5894 721.494 Q32.5894 726.236 35.6131 728.974 Q38.6368 731.711 43.8567 731.711 L64.0042 731.711 L64.0042 737.599 L28.3562 737.599 L28.3562 731.711 L33.8944 731.711 Q30.6797 729.61 29.0883 726.777 Q27.4968 723.913 27.4968 720.189 Q27.4968 714.046 31.3163 710.895 Q35.1038 707.744 42.4881 707.744 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M29.7248 670.409 L35.1993 670.409 Q33.8307 672.892 33.1623 675.406 Q32.4621 677.889 32.4621 680.435 Q32.4621 686.132 36.0905 689.283 Q39.6872 692.434 46.212 692.434 Q52.7369 692.434 56.3653 689.283 Q59.9619 686.132 59.9619 680.435 Q59.9619 677.889 59.2935 675.406 Q58.5933 672.892 57.2247 670.409 L62.6355 670.409 Q63.7814 672.86 64.3543 675.502 Q64.9272 678.112 64.9272 681.072 Q64.9272 689.124 59.8664 693.867 Q54.8057 698.609 46.212 698.609 Q37.491 698.609 32.4939 693.835 Q27.4968 689.029 27.4968 680.69 Q27.4968 677.984 28.0697 675.406 Q28.6108 672.828 29.7248 670.409 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M18.2347 654.431 L28.3562 654.431 L28.3562 642.368 L32.9077 642.368 L32.9077 654.431 L52.2594 654.431 Q56.6199 654.431 57.8613 653.253 Q59.1026 652.044 59.1026 648.384 L59.1026 642.368 L64.0042 642.368 L64.0042 648.384 Q64.0042 655.163 61.4897 657.741 Q58.9434 660.319 52.2594 660.319 L32.9077 660.319 L32.9077 664.616 L28.3562 664.616 L28.3562 660.319 L18.2347 660.319 L18.2347 654.431 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M28.3562 634.666 L28.3562 628.809 L64.0042 628.809 L64.0042 634.666 L28.3562 634.666 M14.479 634.666 L14.479 628.809 L21.895 628.809 L21.895 634.666 L14.479 634.666 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M32.4621 602.742 Q32.4621 607.452 36.1542 610.189 Q39.8145 612.927 46.212 612.927 Q52.6095 612.927 56.3017 610.221 Q59.9619 607.484 59.9619 602.742 Q59.9619 598.063 56.2698 595.326 Q52.5777 592.588 46.212 592.588 Q39.8781 592.588 36.186 595.326 Q32.4621 598.063 32.4621 602.742 M27.4968 602.742 Q27.4968 595.103 32.4621 590.742 Q37.4273 586.382 46.212 586.382 Q54.9649 586.382 59.9619 590.742 Q64.9272 595.103 64.9272 602.742 Q64.9272 610.412 59.9619 614.773 Q54.9649 619.101 46.212 619.101 Q37.4273 619.101 32.4621 614.773 Q27.4968 610.412 27.4968 602.742 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M42.4881 547.042 L64.0042 547.042 L64.0042 552.898 L42.679 552.898 Q37.6183 552.898 35.1038 554.871 Q32.5894 556.845 32.5894 560.792 Q32.5894 565.534 35.6131 568.271 Q38.6368 571.009 43.8567 571.009 L64.0042 571.009 L64.0042 576.897 L28.3562 576.897 L28.3562 571.009 L33.8944 571.009 Q30.6797 568.908 29.0883 566.075 Q27.4968 563.211 27.4968 559.487 Q27.4968 553.344 31.3163 550.193 Q35.1038 547.042 42.4881 547.042 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M55.9197 533.865 L55.9197 527.149 L61.3942 527.149 L71.5793 532.369 L71.5793 536.475 L61.3942 533.865 L55.9197 533.865 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M28.3562 498.121 L28.3562 491.915 L58.275 480.775 L28.3562 469.635 L28.3562 463.428 L64.0042 476.796 L64.0042 484.753 L28.3562 498.121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip572)" style="stroke:#6b9e32; stroke-linecap:round; stroke-linejoin:round; stroke-width:8; stroke-opacity:1; fill:none" points="331.177,1384.24 351.003,174.132 370.828,147.96 390.653,136.133 410.478,128.738 430.304,123.492 450.129,119.647 469.954,116.638 489.779,114.205 509.605,112.159 529.43,110.422 549.255,108.896 569.08,107.559 588.905,106.383 608.731,105.337 628.556,104.396 648.381,103.54 668.206,102.753 688.032,102.019 707.857,101.324 727.682,100.657 747.507,100.079 767.332,99.5581 787.158,99.0538 806.983,98.5706 826.808,98.1115 846.633,97.6793 866.459,97.2757 886.284,96.8837 906.109,96.5152 925.934,96.1605 945.76,95.8301 965.585,95.505 985.41,95.192 1005.24,94.9034 1025.06,94.622 1044.89,94.3434 1064.71,94.0755 1084.54,93.8312 1104.36,93.5871 1124.19,93.3512 1144.01,93.1195 1163.84,92.8992 1183.66,92.6807 1203.49,92.4822 1223.31,92.2855 1243.14,92.0882 1262.96,91.899 1282.79,91.715 1302.61,91.5351 1322.44,91.3613 1342.26,91.1902 1362.09,91.0248 1381.91,90.8715 1401.74,90.7199 1421.56,90.5678 1441.39,90.4163 1461.22,90.2732 1481.04,90.1304 1500.87,89.9914 1520.69,89.8572 1540.52,89.7233 1560.34,89.5939 1580.17,89.4681 1599.99,89.3418 1619.82,89.2204 1639.64,89.1026 1659.47,88.9914 1679.29,88.881 1699.12,88.7706 1718.94,88.6608 1738.77,88.5524 1758.59,88.4456 1778.42,88.3441 1798.24,88.2435 1818.07,88.1416 1837.89,88.0439 1857.72,87.9474 1877.55,87.8534 1897.37,87.7605 1917.2,87.6677 1937.02,87.5782 1956.85,87.49 1976.67,87.4031 1996.5,87.3166 2016.32,87.2314 2036.15,87.1486 2055.97,87.0674 2075.8,86.9873 2095.62,86.9098 2115.45,86.835 2135.27,86.7609 2155.1,86.6864 2174.92,86.6126 2194.75,86.5399 2214.57,86.4665 2234.4,86.3946 2254.22,86.3242 2274.05,86.2533 2293.87,86.1857 "></polyline>
</svg>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">pol_plot</span>(k, pol) </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    Plots.<span class="fu">plot</span>(k, k[pol], primary<span class="op">=</span><span class="cn">false</span>, xlabel <span class="op">=</span> <span class="st">"Current capital stock, k "</span>, ylabel <span class="op">=</span> <span class="st">"Policy function, k'"</span>, linewidth<span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pol_plot</span>(k, pol) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewbox="0 0 2400 1600">
<defs>
  <clippath id="clip660">
    <rect x="0" y="0" width="2400" height="1600"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip660)" d="M0 1600 L2400 1600 L2400 8.88178e-14 L0 8.88178e-14  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip661">
    <rect x="480" y="0" width="1681" height="1600"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip660)" d="M247.459 1423.18 L2352.76 1423.18 L2352.76 47.2441 L247.459 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip662">
    <rect x="247" y="47" width="2106" height="1377"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="305.655,1423.18 305.655,47.2441 "></polyline>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="722.019,1423.18 722.019,47.2441 "></polyline>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1138.38,1423.18 1138.38,47.2441 "></polyline>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1554.75,1423.18 1554.75,47.2441 "></polyline>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1971.11,1423.18 1971.11,47.2441 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="247.459,1423.18 2352.76,1423.18 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="305.655,1423.18 305.655,1404.28 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="722.019,1423.18 722.019,1404.28 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1138.38,1423.18 1138.38,1404.28 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1554.75,1423.18 1554.75,1404.28 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1971.11,1423.18 1971.11,1404.28 "></polyline>
<path clip-path="url(#clip660)" d="M305.655 1454.1 Q302.044 1454.1 300.215 1457.66 Q298.409 1461.2 298.409 1468.33 Q298.409 1475.44 300.215 1479.01 Q302.044 1482.55 305.655 1482.55 Q309.289 1482.55 311.094 1479.01 Q312.923 1475.44 312.923 1468.33 Q312.923 1461.2 311.094 1457.66 Q309.289 1454.1 305.655 1454.1 M305.655 1450.39 Q311.465 1450.39 314.52 1455 Q317.599 1459.58 317.599 1468.33 Q317.599 1477.06 314.52 1481.67 Q311.465 1486.25 305.655 1486.25 Q299.845 1486.25 296.766 1481.67 Q293.71 1477.06 293.71 1468.33 Q293.71 1459.58 296.766 1455 Q299.845 1450.39 305.655 1450.39 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M726.267 1466.95 Q729.624 1467.66 731.499 1469.93 Q733.397 1472.2 733.397 1475.53 Q733.397 1480.65 729.878 1483.45 Q726.36 1486.25 719.878 1486.25 Q717.702 1486.25 715.387 1485.81 Q713.096 1485.39 710.642 1484.54 L710.642 1480.02 Q712.587 1481.16 714.901 1481.74 Q717.216 1482.32 719.739 1482.32 Q724.137 1482.32 726.429 1480.58 Q728.744 1478.84 728.744 1475.53 Q728.744 1472.48 726.591 1470.77 Q724.462 1469.03 720.642 1469.03 L716.614 1469.03 L716.614 1465.19 L720.827 1465.19 Q724.276 1465.19 726.105 1463.82 Q727.934 1462.43 727.934 1459.84 Q727.934 1457.18 726.036 1455.77 Q724.161 1454.33 720.642 1454.33 Q718.721 1454.33 716.522 1454.75 Q714.323 1455.16 711.684 1456.04 L711.684 1451.88 Q714.346 1451.14 716.661 1450.77 Q718.999 1450.39 721.059 1450.39 Q726.383 1450.39 729.485 1452.83 Q732.586 1455.23 732.586 1459.35 Q732.586 1462.22 730.943 1464.21 Q729.299 1466.18 726.267 1466.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1138.79 1466.44 Q1135.64 1466.44 1133.79 1468.59 Q1131.96 1470.74 1131.96 1474.49 Q1131.96 1478.22 1133.79 1480.39 Q1135.64 1482.55 1138.79 1482.55 Q1141.94 1482.55 1143.77 1480.39 Q1145.62 1478.22 1145.62 1474.49 Q1145.62 1470.74 1143.77 1468.59 Q1141.94 1466.44 1138.79 1466.44 M1148.07 1451.78 L1148.07 1456.04 Q1146.31 1455.21 1144.51 1454.77 Q1142.72 1454.33 1140.97 1454.33 Q1136.34 1454.33 1133.88 1457.45 Q1131.45 1460.58 1131.1 1466.9 Q1132.47 1464.89 1134.53 1463.82 Q1136.59 1462.73 1139.07 1462.73 Q1144.28 1462.73 1147.28 1465.9 Q1150.32 1469.05 1150.32 1474.49 Q1150.32 1479.82 1147.17 1483.03 Q1144.02 1486.25 1138.79 1486.25 Q1132.79 1486.25 1129.62 1481.67 Q1126.45 1477.06 1126.45 1468.33 Q1126.45 1460.14 1130.34 1455.28 Q1134.23 1450.39 1140.78 1450.39 Q1142.54 1450.39 1144.32 1450.74 Q1146.13 1451.09 1148.07 1451.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1545.05 1484.86 L1545.05 1480.6 Q1546.81 1481.44 1548.61 1481.88 Q1550.42 1482.32 1552.16 1482.32 Q1556.79 1482.32 1559.22 1479.21 Q1561.67 1476.09 1562.02 1469.75 Q1560.67 1471.74 1558.61 1472.8 Q1556.55 1473.87 1554.05 1473.87 Q1548.87 1473.87 1545.84 1470.74 Q1542.83 1467.59 1542.83 1462.15 Q1542.83 1456.83 1545.98 1453.61 Q1549.12 1450.39 1554.36 1450.39 Q1560.35 1450.39 1563.5 1455 Q1566.67 1459.58 1566.67 1468.33 Q1566.67 1476.51 1562.78 1481.39 Q1558.92 1486.25 1552.36 1486.25 Q1550.61 1486.25 1548.8 1485.9 Q1546.99 1485.56 1545.05 1484.86 M1554.36 1470.21 Q1557.5 1470.21 1559.33 1468.06 Q1561.18 1465.9 1561.18 1462.15 Q1561.18 1458.43 1559.33 1456.27 Q1557.5 1454.1 1554.36 1454.1 Q1551.21 1454.1 1549.36 1456.27 Q1547.53 1458.43 1547.53 1462.15 Q1547.53 1465.9 1549.36 1468.06 Q1551.21 1470.21 1554.36 1470.21 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1946.6 1481.64 L1954.24 1481.64 L1954.24 1455.28 L1945.93 1456.95 L1945.93 1452.69 L1954.19 1451.02 L1958.87 1451.02 L1958.87 1481.64 L1966.51 1481.64 L1966.51 1485.58 L1946.6 1485.58 L1946.6 1481.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1979.98 1481.64 L1996.3 1481.64 L1996.3 1485.58 L1974.35 1485.58 L1974.35 1481.64 Q1977.02 1478.89 1981.6 1474.26 Q1986.21 1469.61 1987.39 1468.27 Q1989.63 1465.74 1990.51 1464.01 Q1991.41 1462.25 1991.41 1460.56 Q1991.41 1457.8 1989.47 1456.07 Q1987.55 1454.33 1984.45 1454.33 Q1982.25 1454.33 1979.79 1455.09 Q1977.36 1455.86 1974.59 1457.41 L1974.59 1452.69 Q1977.41 1451.55 1979.86 1450.97 Q1982.32 1450.39 1984.35 1450.39 Q1989.72 1450.39 1992.92 1453.08 Q1996.11 1455.77 1996.11 1460.26 Q1996.11 1462.39 1995.3 1464.31 Q1994.52 1466.2 1992.41 1468.8 Q1991.83 1469.47 1988.73 1472.69 Q1985.63 1475.88 1979.98 1481.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M951.235 1524.18 L951.235 1530.96 Q947.988 1527.94 944.296 1526.44 Q940.636 1524.95 936.498 1524.95 Q928.35 1524.95 924.021 1529.95 Q919.693 1534.91 919.693 1544.33 Q919.693 1553.72 924.021 1558.72 Q928.35 1563.68 936.498 1563.68 Q940.636 1563.68 944.296 1562.19 Q947.988 1560.69 951.235 1557.67 L951.235 1564.38 Q947.861 1566.68 944.073 1567.82 Q940.318 1568.97 936.116 1568.97 Q925.326 1568.97 919.12 1562.38 Q912.913 1555.76 912.913 1544.33 Q912.913 1532.87 919.12 1526.28 Q925.326 1519.66 936.116 1519.66 Q940.381 1519.66 944.137 1520.81 Q947.925 1521.92 951.235 1524.18 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M960.306 1553.98 L960.306 1532.4 L966.162 1532.4 L966.162 1553.75 Q966.162 1558.81 968.136 1561.36 Q970.109 1563.87 974.056 1563.87 Q978.798 1563.87 981.536 1560.85 Q984.305 1557.83 984.305 1552.61 L984.305 1532.4 L990.161 1532.4 L990.161 1568.04 L984.305 1568.04 L984.305 1562.57 Q982.172 1565.82 979.339 1567.41 Q976.538 1568.97 972.815 1568.97 Q966.672 1568.97 963.489 1565.15 Q960.306 1561.33 960.306 1553.98 M975.042 1531.54 L975.042 1531.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1022.88 1537.87 Q1021.89 1537.3 1020.72 1537.04 Q1019.57 1536.76 1018.17 1536.76 Q1013.2 1536.76 1010.53 1540 Q1007.89 1543.22 1007.89 1549.27 L1007.89 1568.04 L1002 1568.04 L1002 1532.4 L1007.89 1532.4 L1007.89 1537.93 Q1009.74 1534.69 1012.7 1533.13 Q1015.66 1531.54 1019.89 1531.54 Q1020.49 1531.54 1021.23 1531.63 Q1021.96 1531.7 1022.85 1531.85 L1022.88 1537.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1048.53 1537.87 Q1047.55 1537.3 1046.37 1537.04 Q1045.22 1536.76 1043.82 1536.76 Q1038.86 1536.76 1036.19 1540 Q1033.54 1543.22 1033.54 1549.27 L1033.54 1568.04 L1027.66 1568.04 L1027.66 1532.4 L1033.54 1532.4 L1033.54 1537.93 Q1035.39 1534.69 1038.35 1533.13 Q1041.31 1531.54 1045.54 1531.54 Q1046.15 1531.54 1046.88 1531.63 Q1047.61 1531.7 1048.5 1531.85 L1048.53 1537.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1083.74 1548.76 L1083.74 1551.62 L1056.81 1551.62 Q1057.19 1557.67 1060.44 1560.85 Q1063.72 1564 1069.54 1564 Q1072.92 1564 1076.07 1563.17 Q1079.25 1562.35 1082.37 1560.69 L1082.37 1566.23 Q1079.22 1567.57 1075.91 1568.27 Q1072.6 1568.97 1069.19 1568.97 Q1060.66 1568.97 1055.66 1564 Q1050.7 1559.04 1050.7 1550.57 Q1050.7 1541.82 1055.41 1536.69 Q1060.15 1531.54 1068.17 1531.54 Q1075.37 1531.54 1079.54 1536.18 Q1083.74 1540.8 1083.74 1548.76 M1077.88 1547.04 Q1077.82 1542.23 1075.18 1539.37 Q1072.57 1536.5 1068.24 1536.5 Q1063.33 1536.5 1060.37 1539.27 Q1057.45 1542.04 1057 1547.07 L1077.88 1547.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1122.98 1546.53 L1122.98 1568.04 L1117.13 1568.04 L1117.13 1546.72 Q1117.13 1541.66 1115.15 1539.14 Q1113.18 1536.63 1109.23 1536.63 Q1104.49 1536.63 1101.75 1539.65 Q1099.01 1542.68 1099.01 1547.9 L1099.01 1568.04 L1093.13 1568.04 L1093.13 1532.4 L1099.01 1532.4 L1099.01 1537.93 Q1101.12 1534.72 1103.95 1533.13 Q1106.81 1531.54 1110.54 1531.54 Q1116.68 1531.54 1119.83 1535.36 Q1122.98 1539.14 1122.98 1546.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1140.46 1522.27 L1140.46 1532.4 L1152.52 1532.4 L1152.52 1536.95 L1140.46 1536.95 L1140.46 1556.3 Q1140.46 1560.66 1141.63 1561.9 Q1142.84 1563.14 1146.5 1563.14 L1152.52 1563.14 L1152.52 1568.04 L1146.5 1568.04 Q1139.72 1568.04 1137.15 1565.53 Q1134.57 1562.98 1134.57 1556.3 L1134.57 1536.95 L1130.27 1536.95 L1130.27 1532.4 L1134.57 1532.4 L1134.57 1522.27 L1140.46 1522.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1206.6 1533.76 L1206.6 1539.24 Q1204.11 1537.87 1201.6 1537.2 Q1199.12 1536.5 1196.57 1536.5 Q1190.87 1536.5 1187.72 1540.13 Q1184.57 1543.73 1184.57 1550.25 Q1184.57 1556.78 1187.72 1560.4 Q1190.87 1564 1196.57 1564 Q1199.12 1564 1201.6 1563.33 Q1204.11 1562.63 1206.6 1561.26 L1206.6 1566.68 Q1204.14 1567.82 1201.5 1568.39 Q1198.89 1568.97 1195.93 1568.97 Q1187.88 1568.97 1183.14 1563.91 Q1178.39 1558.85 1178.39 1550.25 Q1178.39 1541.53 1183.17 1536.53 Q1187.98 1531.54 1196.31 1531.54 Q1199.02 1531.54 1201.6 1532.11 Q1204.18 1532.65 1206.6 1533.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1232.98 1550.12 Q1225.88 1550.12 1223.15 1551.75 Q1220.41 1553.37 1220.41 1557.29 Q1220.41 1560.4 1222.45 1562.25 Q1224.51 1564.07 1228.05 1564.07 Q1232.92 1564.07 1235.85 1560.63 Q1238.81 1557.16 1238.81 1551.43 L1238.81 1550.12 L1232.98 1550.12 M1244.66 1547.71 L1244.66 1568.04 L1238.81 1568.04 L1238.81 1562.63 Q1236.8 1565.88 1233.81 1567.44 Q1230.82 1568.97 1226.49 1568.97 Q1221.01 1568.97 1217.77 1565.91 Q1214.55 1562.82 1214.55 1557.67 Q1214.55 1551.65 1218.56 1548.6 Q1222.6 1545.54 1230.59 1545.54 L1238.81 1545.54 L1238.81 1544.97 Q1238.81 1540.93 1236.13 1538.73 Q1233.49 1536.5 1228.68 1536.5 Q1225.63 1536.5 1222.73 1537.23 Q1219.84 1537.97 1217.16 1539.43 L1217.16 1534.02 Q1220.38 1532.78 1223.4 1532.17 Q1226.42 1531.54 1229.29 1531.54 Q1237.02 1531.54 1240.84 1535.55 Q1244.66 1539.56 1244.66 1547.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1262.39 1562.7 L1262.39 1581.6 L1256.5 1581.6 L1256.5 1532.4 L1262.39 1532.4 L1262.39 1537.81 Q1264.24 1534.62 1267.04 1533.1 Q1269.87 1531.54 1273.79 1531.54 Q1280.28 1531.54 1284.32 1536.69 Q1288.39 1541.85 1288.39 1550.25 Q1288.39 1558.65 1284.32 1563.81 Q1280.28 1568.97 1273.79 1568.97 Q1269.87 1568.97 1267.04 1567.44 Q1264.24 1565.88 1262.39 1562.7 M1282.32 1550.25 Q1282.32 1543.79 1279.64 1540.13 Q1277 1536.44 1272.35 1536.44 Q1267.71 1536.44 1265.03 1540.13 Q1262.39 1543.79 1262.39 1550.25 Q1262.39 1556.71 1265.03 1560.4 Q1267.71 1564.07 1272.35 1564.07 Q1277 1564.07 1279.64 1560.4 Q1282.32 1556.71 1282.32 1550.25 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1298.1 1532.4 L1303.96 1532.4 L1303.96 1568.04 L1298.1 1568.04 L1298.1 1532.4 M1298.1 1518.52 L1303.96 1518.52 L1303.96 1525.93 L1298.1 1525.93 L1298.1 1518.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1322.01 1522.27 L1322.01 1532.4 L1334.07 1532.4 L1334.07 1536.95 L1322.01 1536.95 L1322.01 1556.3 Q1322.01 1560.66 1323.18 1561.9 Q1324.39 1563.14 1328.05 1563.14 L1334.07 1563.14 L1334.07 1568.04 L1328.05 1568.04 Q1321.27 1568.04 1318.7 1565.53 Q1316.12 1562.98 1316.12 1556.3 L1316.12 1536.95 L1311.82 1536.95 L1311.82 1532.4 L1316.12 1532.4 L1316.12 1522.27 L1322.01 1522.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1357.97 1550.12 Q1350.87 1550.12 1348.14 1551.75 Q1345.4 1553.37 1345.4 1557.29 Q1345.4 1560.4 1347.44 1562.25 Q1349.51 1564.07 1353.04 1564.07 Q1357.91 1564.07 1360.84 1560.63 Q1363.8 1557.16 1363.8 1551.43 L1363.8 1550.12 L1357.97 1550.12 M1369.65 1547.71 L1369.65 1568.04 L1363.8 1568.04 L1363.8 1562.63 Q1361.79 1565.88 1358.8 1567.44 Q1355.81 1568.97 1351.48 1568.97 Q1346 1568.97 1342.76 1565.91 Q1339.54 1562.82 1339.54 1557.67 Q1339.54 1551.65 1343.55 1548.6 Q1347.6 1545.54 1355.58 1545.54 L1363.8 1545.54 L1363.8 1544.97 Q1363.8 1540.93 1361.12 1538.73 Q1358.48 1536.5 1353.67 1536.5 Q1350.62 1536.5 1347.72 1537.23 Q1344.83 1537.97 1342.15 1539.43 L1342.15 1534.02 Q1345.37 1532.78 1348.39 1532.17 Q1351.41 1531.54 1354.28 1531.54 Q1362.01 1531.54 1365.83 1535.55 Q1369.65 1539.56 1369.65 1547.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1381.72 1518.52 L1387.57 1518.52 L1387.57 1568.04 L1381.72 1568.04 L1381.72 1518.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1443.27 1533.45 L1443.27 1538.98 Q1440.79 1537.71 1438.12 1537.07 Q1435.44 1536.44 1432.58 1536.44 Q1428.22 1536.44 1426.02 1537.77 Q1423.86 1539.11 1423.86 1541.79 Q1423.86 1543.82 1425.42 1545 Q1426.98 1546.15 1431.69 1547.2 L1433.69 1547.64 Q1439.93 1548.98 1442.54 1551.43 Q1445.18 1553.85 1445.18 1558.21 Q1445.18 1563.17 1441.24 1566.07 Q1437.32 1568.97 1430.45 1568.97 Q1427.58 1568.97 1424.46 1568.39 Q1421.37 1567.85 1417.94 1566.74 L1417.94 1560.69 Q1421.18 1562.38 1424.33 1563.24 Q1427.49 1564.07 1430.57 1564.07 Q1434.71 1564.07 1436.94 1562.66 Q1439.17 1561.23 1439.17 1558.65 Q1439.17 1556.27 1437.54 1554.99 Q1435.95 1553.72 1430.51 1552.54 L1428.47 1552.07 Q1423.03 1550.92 1420.61 1548.56 Q1418.19 1546.18 1418.19 1542.04 Q1418.19 1537.01 1421.76 1534.27 Q1425.32 1531.54 1431.88 1531.54 Q1435.12 1531.54 1437.99 1532.01 Q1440.85 1532.49 1443.27 1533.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1460.3 1522.27 L1460.3 1532.4 L1472.36 1532.4 L1472.36 1536.95 L1460.3 1536.95 L1460.3 1556.3 Q1460.3 1560.66 1461.48 1561.9 Q1462.69 1563.14 1466.35 1563.14 L1472.36 1563.14 L1472.36 1568.04 L1466.35 1568.04 Q1459.57 1568.04 1456.99 1565.53 Q1454.41 1562.98 1454.41 1556.3 L1454.41 1536.95 L1450.12 1536.95 L1450.12 1532.4 L1454.41 1532.4 L1454.41 1522.27 L1460.3 1522.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1493.88 1536.5 Q1489.17 1536.5 1486.43 1540.19 Q1483.69 1543.85 1483.69 1550.25 Q1483.69 1556.65 1486.4 1560.34 Q1489.14 1564 1493.88 1564 Q1498.56 1564 1501.3 1560.31 Q1504.03 1556.62 1504.03 1550.25 Q1504.03 1543.92 1501.3 1540.23 Q1498.56 1536.5 1493.88 1536.5 M1493.88 1531.54 Q1501.52 1531.54 1505.88 1536.5 Q1510.24 1541.47 1510.24 1550.25 Q1510.24 1559 1505.88 1564 Q1501.52 1568.97 1493.88 1568.97 Q1486.21 1568.97 1481.85 1564 Q1477.52 1559 1477.52 1550.25 Q1477.52 1541.47 1481.85 1536.5 Q1486.21 1531.54 1493.88 1531.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1545.6 1533.76 L1545.6 1539.24 Q1543.12 1537.87 1540.6 1537.2 Q1538.12 1536.5 1535.57 1536.5 Q1529.88 1536.5 1526.73 1540.13 Q1523.58 1543.73 1523.58 1550.25 Q1523.58 1556.78 1526.73 1560.4 Q1529.88 1564 1535.57 1564 Q1538.12 1564 1540.6 1563.33 Q1543.12 1562.63 1545.6 1561.26 L1545.6 1566.68 Q1543.15 1567.82 1540.51 1568.39 Q1537.9 1568.97 1534.94 1568.97 Q1526.89 1568.97 1522.14 1563.91 Q1517.4 1558.85 1517.4 1550.25 Q1517.4 1541.53 1522.17 1536.53 Q1526.98 1531.54 1535.32 1531.54 Q1538.03 1531.54 1540.6 1532.11 Q1543.18 1532.65 1545.6 1533.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1555.56 1518.52 L1561.45 1518.52 L1561.45 1547.77 L1578.93 1532.4 L1586.4 1532.4 L1567.5 1549.07 L1587.2 1568.04 L1579.56 1568.04 L1561.45 1550.63 L1561.45 1568.04 L1555.56 1568.04 L1555.56 1518.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1595.03 1559.96 L1601.75 1559.96 L1601.75 1565.43 L1596.53 1575.62 L1592.42 1575.62 L1595.03 1565.43 L1595.03 1559.96 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M1634.75 1518.52 L1640.64 1518.52 L1640.64 1547.77 L1658.11 1532.4 L1665.59 1532.4 L1646.69 1549.07 L1666.39 1568.04 L1658.75 1568.04 L1640.64 1550.63 L1640.64 1568.04 L1634.75 1568.04 L1634.75 1518.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="247.459,1385.49 2352.76,1385.49 "></polyline>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="247.459,1073.68 2352.76,1073.68 "></polyline>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="247.459,761.88 2352.76,761.88 "></polyline>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="247.459,450.077 2352.76,450.077 "></polyline>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="247.459,138.274 2352.76,138.274 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="247.459,1423.18 247.459,47.2441 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="247.459,1385.49 266.356,1385.49 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="247.459,1073.68 266.356,1073.68 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="247.459,761.88 266.356,761.88 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="247.459,450.077 266.356,450.077 "></polyline>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="247.459,138.274 266.356,138.274 "></polyline>
<path clip-path="url(#clip660)" d="M154.283 1371.28 Q150.672 1371.28 148.843 1374.85 Q147.038 1378.39 147.038 1385.52 Q147.038 1392.63 148.843 1396.19 Q150.672 1399.73 154.283 1399.73 Q157.917 1399.73 159.723 1396.19 Q161.552 1392.63 161.552 1385.52 Q161.552 1378.39 159.723 1374.85 Q157.917 1371.28 154.283 1371.28 M154.283 1367.58 Q160.093 1367.58 163.149 1372.19 Q166.227 1376.77 166.227 1385.52 Q166.227 1394.25 163.149 1398.85 Q160.093 1403.44 154.283 1403.44 Q148.473 1403.44 145.394 1398.85 Q142.339 1394.25 142.339 1385.52 Q142.339 1376.77 145.394 1372.19 Q148.473 1367.58 154.283 1367.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M174.445 1396.89 L179.329 1396.89 L179.329 1402.77 L174.445 1402.77 L174.445 1396.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M199.514 1371.28 Q195.903 1371.28 194.075 1374.85 Q192.269 1378.39 192.269 1385.52 Q192.269 1392.63 194.075 1396.19 Q195.903 1399.73 199.514 1399.73 Q203.149 1399.73 204.954 1396.19 Q206.783 1392.63 206.783 1385.52 Q206.783 1378.39 204.954 1374.85 Q203.149 1371.28 199.514 1371.28 M199.514 1367.58 Q205.324 1367.58 208.38 1372.19 Q211.459 1376.77 211.459 1385.52 Q211.459 1394.25 208.38 1398.85 Q205.324 1403.44 199.514 1403.44 Q193.704 1403.44 190.625 1398.85 Q187.57 1394.25 187.57 1385.52 Q187.57 1376.77 190.625 1372.19 Q193.704 1367.58 199.514 1367.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M149.306 1087.03 L165.626 1087.03 L165.626 1090.96 L143.681 1090.96 L143.681 1087.03 Q146.343 1084.27 150.927 1079.64 Q155.533 1074.99 156.714 1073.65 Q158.959 1071.12 159.839 1069.39 Q160.741 1067.63 160.741 1065.94 Q160.741 1063.18 158.797 1061.45 Q156.876 1059.71 153.774 1059.71 Q151.575 1059.71 149.121 1060.48 Q146.691 1061.24 143.913 1062.79 L143.913 1058.07 Q146.737 1056.94 149.191 1056.36 Q151.644 1055.78 153.681 1055.78 Q159.052 1055.78 162.246 1058.46 Q165.44 1061.15 165.44 1065.64 Q165.44 1067.77 164.63 1069.69 Q163.843 1071.59 161.737 1074.18 Q161.158 1074.85 158.056 1078.07 Q154.954 1081.26 149.306 1087.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M175.44 1085.08 L180.325 1085.08 L180.325 1090.96 L175.44 1090.96 L175.44 1085.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M190.556 1056.4 L208.912 1056.4 L208.912 1060.34 L194.838 1060.34 L194.838 1068.81 Q195.857 1068.46 196.875 1068.3 Q197.894 1068.12 198.912 1068.12 Q204.699 1068.12 208.079 1071.29 Q211.459 1074.46 211.459 1079.87 Q211.459 1085.45 207.987 1088.56 Q204.514 1091.63 198.195 1091.63 Q196.019 1091.63 193.75 1091.26 Q191.505 1090.89 189.098 1090.15 L189.098 1085.45 Q191.181 1086.59 193.403 1087.14 Q195.625 1087.7 198.102 1087.7 Q202.107 1087.7 204.445 1085.59 Q206.783 1083.49 206.783 1079.87 Q206.783 1076.26 204.445 1074.16 Q202.107 1072.05 198.102 1072.05 Q196.227 1072.05 194.352 1072.47 Q192.5 1072.88 190.556 1073.76 L190.556 1056.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M144.329 744.6 L162.686 744.6 L162.686 748.535 L148.612 748.535 L148.612 757.007 Q149.63 756.66 150.649 756.498 Q151.667 756.313 152.686 756.313 Q158.473 756.313 161.852 759.484 Q165.232 762.655 165.232 768.072 Q165.232 773.651 161.76 776.752 Q158.288 779.831 151.968 779.831 Q149.792 779.831 147.524 779.461 Q145.279 779.09 142.871 778.35 L142.871 773.651 Q144.954 774.785 147.177 775.34 Q149.399 775.896 151.876 775.896 Q155.88 775.896 158.218 773.789 Q160.556 771.683 160.556 768.072 Q160.556 764.461 158.218 762.354 Q155.88 760.248 151.876 760.248 Q150.001 760.248 148.126 760.665 Q146.274 761.081 144.329 761.961 L144.329 744.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M174.445 773.28 L179.329 773.28 L179.329 779.16 L174.445 779.16 L174.445 773.28 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M199.514 747.678 Q195.903 747.678 194.075 751.243 Q192.269 754.785 192.269 761.914 Q192.269 769.021 194.075 772.586 Q195.903 776.127 199.514 776.127 Q203.149 776.127 204.954 772.586 Q206.783 769.021 206.783 761.914 Q206.783 754.785 204.954 751.243 Q203.149 747.678 199.514 747.678 M199.514 743.975 Q205.324 743.975 208.38 748.581 Q211.459 753.165 211.459 761.914 Q211.459 770.641 208.38 775.248 Q205.324 779.831 199.514 779.831 Q193.704 779.831 190.625 775.248 Q187.57 770.641 187.57 761.914 Q187.57 753.165 190.625 748.581 Q193.704 743.975 199.514 743.975 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M144.098 432.797 L166.32 432.797 L166.32 434.788 L153.774 467.357 L148.89 467.357 L160.695 436.732 L144.098 436.732 L144.098 432.797 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M175.44 461.477 L180.325 461.477 L180.325 467.357 L175.44 467.357 L175.44 461.477 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M190.556 432.797 L208.912 432.797 L208.912 436.732 L194.838 436.732 L194.838 445.204 Q195.857 444.857 196.875 444.695 Q197.894 444.51 198.912 444.51 Q204.699 444.51 208.079 447.681 Q211.459 450.852 211.459 456.269 Q211.459 461.848 207.987 464.95 Q204.514 468.028 198.195 468.028 Q196.019 468.028 193.75 467.658 Q191.505 467.287 189.098 466.547 L189.098 461.848 Q191.181 462.982 193.403 463.537 Q195.625 464.093 198.102 464.093 Q202.107 464.093 204.445 461.987 Q206.783 459.88 206.783 456.269 Q206.783 452.658 204.445 450.551 Q202.107 448.445 198.102 448.445 Q196.227 448.445 194.352 448.862 Q192.5 449.278 190.556 450.158 L190.556 432.797 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M114.931 151.619 L122.57 151.619 L122.57 125.253 L114.26 126.92 L114.26 122.661 L122.524 120.994 L127.2 120.994 L127.2 151.619 L134.839 151.619 L134.839 155.554 L114.931 155.554 L114.931 151.619 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M154.283 124.073 Q150.672 124.073 148.843 127.638 Q147.038 131.179 147.038 138.309 Q147.038 145.415 148.843 148.98 Q150.672 152.522 154.283 152.522 Q157.917 152.522 159.723 148.98 Q161.552 145.415 161.552 138.309 Q161.552 131.179 159.723 127.638 Q157.917 124.073 154.283 124.073 M154.283 120.369 Q160.093 120.369 163.149 124.976 Q166.227 129.559 166.227 138.309 Q166.227 147.036 163.149 151.642 Q160.093 156.225 154.283 156.225 Q148.473 156.225 145.394 151.642 Q142.339 147.036 142.339 138.309 Q142.339 129.559 145.394 124.976 Q148.473 120.369 154.283 120.369 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M174.445 149.674 L179.329 149.674 L179.329 155.554 L174.445 155.554 L174.445 149.674 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M199.514 124.073 Q195.903 124.073 194.075 127.638 Q192.269 131.179 192.269 138.309 Q192.269 145.415 194.075 148.98 Q195.903 152.522 199.514 152.522 Q203.149 152.522 204.954 148.98 Q206.783 145.415 206.783 138.309 Q206.783 131.179 204.954 127.638 Q203.149 124.073 199.514 124.073 M199.514 120.369 Q205.324 120.369 208.38 124.976 Q211.459 129.559 211.459 138.309 Q211.459 147.036 208.38 151.642 Q205.324 156.225 199.514 156.225 Q193.704 156.225 190.625 151.642 Q187.57 147.036 187.57 138.309 Q187.57 129.559 190.625 124.976 Q193.704 120.369 199.514 120.369 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M21.7677 1008.27 L39.6235 1008.27 L39.6235 1000.18 Q39.6235 995.697 37.3 993.246 Q34.9765 990.795 30.6797 990.795 Q26.4147 990.795 24.0912 993.246 Q21.7677 995.697 21.7677 1000.18 L21.7677 1008.27 M16.4842 1014.7 L16.4842 1000.18 Q16.4842 992.196 20.1126 988.121 Q23.7092 984.016 30.6797 984.016 Q37.7138 984.016 41.3104 988.121 Q44.907 992.196 44.907 1000.18 L44.907 1008.27 L64.0042 1008.27 L64.0042 1014.7 L16.4842 1014.7 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M32.4621 964.155 Q32.4621 968.865 36.1542 971.602 Q39.8145 974.34 46.212 974.34 Q52.6095 974.34 56.3017 971.634 Q59.9619 968.897 59.9619 964.155 Q59.9619 959.476 56.2698 956.739 Q52.5777 954.001 46.212 954.001 Q39.8781 954.001 36.186 956.739 Q32.4621 959.476 32.4621 964.155 M27.4968 964.155 Q27.4968 956.516 32.4621 952.155 Q37.4273 947.795 46.212 947.795 Q54.9649 947.795 59.9619 952.155 Q64.9272 956.516 64.9272 964.155 Q64.9272 971.825 59.9619 976.186 Q54.9649 980.514 46.212 980.514 Q37.4273 980.514 32.4621 976.186 Q27.4968 971.825 27.4968 964.155 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M14.479 938.087 L14.479 932.231 L64.0042 932.231 L64.0042 938.087 L14.479 938.087 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M28.3562 919.977 L28.3562 914.12 L64.0042 914.12 L64.0042 919.977 L28.3562 919.977 M14.479 919.977 L14.479 914.12 L21.895 914.12 L21.895 919.977 L14.479 919.977 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M29.7248 876.212 L35.1993 876.212 Q33.8307 878.695 33.1623 881.209 Q32.4621 883.692 32.4621 886.238 Q32.4621 891.936 36.0905 895.087 Q39.6872 898.238 46.212 898.238 Q52.7369 898.238 56.3653 895.087 Q59.9619 891.936 59.9619 886.238 Q59.9619 883.692 59.2935 881.209 Q58.5933 878.695 57.2247 876.212 L62.6355 876.212 Q63.7814 878.663 64.3543 881.305 Q64.9272 883.915 64.9272 886.875 Q64.9272 894.928 59.8664 899.67 Q54.8057 904.412 46.212 904.412 Q37.491 904.412 32.4939 899.638 Q27.4968 894.832 27.4968 886.493 Q27.4968 883.788 28.0697 881.209 Q28.6108 878.631 29.7248 876.212 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M67.3143 851.195 Q73.68 853.678 75.6216 856.033 Q77.5631 858.388 77.5631 862.335 L77.5631 867.014 L72.6615 867.014 L72.6615 863.576 Q72.6615 861.157 71.5157 859.821 Q70.3699 858.484 66.1048 856.861 L63.4312 855.81 L28.3562 870.229 L28.3562 864.022 L56.238 852.882 L28.3562 841.742 L28.3562 835.536 L67.3143 851.195 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M14.479 788.684 L19.3487 788.684 L19.3487 794.286 Q19.3487 797.437 20.6219 798.678 Q21.895 799.888 25.2052 799.888 L28.3562 799.888 L28.3562 790.244 L32.9077 790.244 L32.9077 799.888 L64.0042 799.888 L64.0042 805.776 L32.9077 805.776 L32.9077 811.378 L28.3562 811.378 L28.3562 805.776 L25.8736 805.776 Q19.9216 805.776 17.2162 803.007 Q14.479 800.238 14.479 794.222 L14.479 788.684 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M49.9359 784.387 L28.3562 784.387 L28.3562 778.531 L49.7131 778.531 Q54.7739 778.531 57.3202 776.557 Q59.8346 774.584 59.8346 770.637 Q59.8346 765.895 56.8109 763.157 Q53.7872 760.388 48.5673 760.388 L28.3562 760.388 L28.3562 754.532 L64.0042 754.532 L64.0042 760.388 L58.5296 760.388 Q61.7762 762.521 63.3676 765.354 Q64.9272 768.155 64.9272 771.878 Q64.9272 778.021 61.1078 781.204 Q57.2883 784.387 49.9359 784.387 M27.4968 769.65 L27.4968 769.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M42.4881 712.837 L64.0042 712.837 L64.0042 718.693 L42.679 718.693 Q37.6183 718.693 35.1038 720.666 Q32.5894 722.64 32.5894 726.586 Q32.5894 731.329 35.6131 734.066 Q38.6368 736.803 43.8567 736.803 L64.0042 736.803 L64.0042 742.692 L28.3562 742.692 L28.3562 736.803 L33.8944 736.803 Q30.6797 734.703 29.0883 731.87 Q27.4968 729.005 27.4968 725.281 Q27.4968 719.139 31.3163 715.988 Q35.1038 712.837 42.4881 712.837 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M29.7248 675.502 L35.1993 675.502 Q33.8307 677.984 33.1623 680.499 Q32.4621 682.981 32.4621 685.528 Q32.4621 691.225 36.0905 694.376 Q39.6872 697.527 46.212 697.527 Q52.7369 697.527 56.3653 694.376 Q59.9619 691.225 59.9619 685.528 Q59.9619 682.981 59.2935 680.499 Q58.5933 677.984 57.2247 675.502 L62.6355 675.502 Q63.7814 677.952 64.3543 680.594 Q64.9272 683.204 64.9272 686.164 Q64.9272 694.217 59.8664 698.959 Q54.8057 703.702 46.212 703.702 Q37.491 703.702 32.4939 698.927 Q27.4968 694.121 27.4968 685.782 Q27.4968 683.077 28.0697 680.499 Q28.6108 677.921 29.7248 675.502 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M18.2347 659.524 L28.3562 659.524 L28.3562 647.461 L32.9077 647.461 L32.9077 659.524 L52.2594 659.524 Q56.6199 659.524 57.8613 658.346 Q59.1026 657.137 59.1026 653.476 L59.1026 647.461 L64.0042 647.461 L64.0042 653.476 Q64.0042 660.256 61.4897 662.834 Q58.9434 665.412 52.2594 665.412 L32.9077 665.412 L32.9077 669.709 L28.3562 669.709 L28.3562 665.412 L18.2347 665.412 L18.2347 659.524 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M28.3562 639.758 L28.3562 633.902 L64.0042 633.902 L64.0042 639.758 L28.3562 639.758 M14.479 639.758 L14.479 633.902 L21.895 633.902 L21.895 639.758 L14.479 639.758 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M32.4621 607.834 Q32.4621 612.545 36.1542 615.282 Q39.8145 618.019 46.212 618.019 Q52.6095 618.019 56.3017 615.314 Q59.9619 612.577 59.9619 607.834 Q59.9619 603.155 56.2698 600.418 Q52.5777 597.681 46.212 597.681 Q39.8781 597.681 36.186 600.418 Q32.4621 603.155 32.4621 607.834 M27.4968 607.834 Q27.4968 600.195 32.4621 595.835 Q37.4273 591.474 46.212 591.474 Q54.9649 591.474 59.9619 595.835 Q64.9272 600.195 64.9272 607.834 Q64.9272 615.505 59.9619 619.865 Q54.9649 624.194 46.212 624.194 Q37.4273 624.194 32.4621 619.865 Q27.4968 615.505 27.4968 607.834 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M42.4881 552.134 L64.0042 552.134 L64.0042 557.991 L42.679 557.991 Q37.6183 557.991 35.1038 559.964 Q32.5894 561.937 32.5894 565.884 Q32.5894 570.627 35.6131 573.364 Q38.6368 576.101 43.8567 576.101 L64.0042 576.101 L64.0042 581.989 L28.3562 581.989 L28.3562 576.101 L33.8944 576.101 Q30.6797 574 29.0883 571.168 Q27.4968 568.303 27.4968 564.579 Q27.4968 558.436 31.3163 555.285 Q35.1038 552.134 42.4881 552.134 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M55.9197 538.957 L55.9197 532.241 L61.3942 532.241 L71.5793 537.461 L71.5793 541.567 L61.3942 538.957 L55.9197 538.957 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M14.479 499.235 L14.479 493.347 L43.7294 493.347 L28.3562 475.873 L28.3562 468.393 L45.0344 487.3 L64.0042 467.598 L64.0042 475.237 L46.5939 493.347 L64.0042 493.347 L64.0042 499.235 L14.479 499.235 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip660)" d="M16.4842 455.726 L34.149 455.726 L34.149 461.136 L16.4842 461.136 L16.4842 455.726 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip662)" style="stroke:#6b9e32; stroke-linecap:round; stroke-linejoin:round; stroke-width:8; stroke-opacity:1; fill:none" points="307.043,1384.24 327.105,1348.18 347.166,1330.15 367.228,1312.12 387.29,1294.1 407.352,1258.04 427.414,1240.01 447.476,1221.98 467.538,1203.95 487.6,1185.92 507.662,1167.9 527.724,1167.9 547.786,1149.87 567.847,1131.84 587.909,1113.81 607.971,1095.78 628.033,1077.75 648.095,1059.73 668.157,1041.7 688.219,1023.67 708.281,1023.67 728.343,1005.64 748.405,1005.64 768.467,987.611 788.529,969.583 808.59,951.554 828.652,933.526 848.714,915.497 868.776,915.497 888.838,897.469 908.9,879.44 928.962,861.412 949.024,861.412 969.086,843.383 989.148,825.355 1009.21,807.326 1029.27,807.326 1049.33,789.297 1069.4,789.297 1089.46,771.269 1109.52,753.24 1129.58,735.212 1149.64,717.183 1169.7,717.183 1189.77,699.155 1209.83,681.126 1229.89,681.126 1249.95,663.098 1270.01,645.069 1290.08,645.069 1310.14,627.041 1330.2,609.012 1350.26,609.012 1370.32,590.984 1390.39,590.984 1410.45,572.955 1430.51,554.927 1450.57,536.898 1470.63,536.898 1490.7,518.87 1510.76,500.841 1530.82,500.841 1550.88,482.813 1570.94,464.784 1591.01,464.784 1611.07,446.756 1631.13,446.756 1651.19,428.727 1671.25,428.727 1691.31,410.699 1711.38,392.67 1731.44,374.642 1751.5,374.642 1771.56,356.613 1791.62,356.613 1811.69,338.585 1831.75,320.556 1851.81,320.556 1871.87,302.528 1891.93,284.499 1912,284.499 1932.06,266.471 1952.12,266.471 1972.18,248.442 1992.24,230.414 2012.31,230.414 2032.37,212.385 2052.43,212.385 2072.49,194.357 2092.55,194.357 2112.61,176.328 2132.68,176.328 2152.74,158.3 2172.8,140.271 2192.86,122.243 2212.92,122.243 2232.99,104.214 2253.05,104.214 2273.11,86.1857 2293.17,86.1857 "></polyline>
</svg>
</div>
</div>
<p>Note that both the value function and the policy function are strictly increasing in k. For a proof, the former directly comes from SLP Theorem 4.7. The latter can be induced together with SLP Theorem 4.8.</p>
</section>
<section id="improving-the-code-towards-elegance" class="level5">
<h5 class="anchored" data-anchor-id="improving-the-code-towards-elegance">2.3.2 Improving the code towards elegance</h5>
<p>The code above works fine if you are using matlab (with slight adjustment). To make it better, the first thing you want to take use of is the strong functional operations on Julia. You can invoke pre-defined functions within functions.</p>
<p>Define the utility function and production function each with one line.</p>
<div id="cell-25" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">u</span>(c) <span class="op">=</span> c<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> σ)<span class="op">/</span>(<span class="fl">1</span> <span class="op">-</span> σ)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">F</span>(k) <span class="op">=</span> A <span class="op">*</span> k<span class="op">^</span>α</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>F (generic function with 1 method)</code></pre>
</div>
</div>
<p>Make the functions as inputs to the VFI.</p>
<p>Also I made a minor change so that v and k are generated within the function defined, which is generally considered as good practice.</p>
<div id="cell-27" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VFI (still bad practice)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VFI_baseline_v2</span>(σ, β, A, α, δ, N)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate v and k</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> <span class="fu">zeros</span>(N) <span class="co">#initial guess of value function v(k), here just 0.0 for any k</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    k_tilde <span class="op">=</span> (A <span class="op">/</span> δ)<span class="op">^</span>(<span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> α))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0.01</span>, k_tilde, N) <span class="co">#Note that the grids for k' is same as k</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    pol <span class="op">=</span> <span class="fu">similar</span>(v, <span class="dt">Int</span>) <span class="co"># will be used for storing the policy function (k'), as an index</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for storing updated value function</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    iterate <span class="op">=</span> <span class="fl">0</span> <span class="co"># keep track of how many iterations we have run</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-6</span> <span class="co"># the critical tolerance</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="cn">true</span> <span class="co"># the code keeps iterating itself until we manualy break it</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used to keep track of the difference between v and Tv</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># outer loop over each grid of v</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(v) <span class="co"># iterate over value function</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>            pol_i <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>            just_started <span class="op">=</span> <span class="cn">true</span>  <span class="co"># will be used later to store v with choosing k'= 0</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>            vmax <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used later to store the maximized v</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># most inner loop over potential k'</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="fu">eachindex</span>(k) </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> <span class="fu">F</span>(k[i]) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> δ) <span class="op">*</span> k[i] <span class="op">-</span> k[j] <span class="co"># this is the consumption if we choose k' = k[j]</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;=</span> <span class="fl">0.0</span> <span class="co"># make sure consumption is nonnegative</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>                    v_tmp <span class="op">=</span> <span class="fu">u</span>(c) <span class="op">+</span> β <span class="op">*</span> v[j] <span class="co">#v if choosing k' = k[j]</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> just_started <span class="co"># logic operation </span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp <span class="co"># store the value function</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j <span class="co"># store the policy function (an index on k)</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>                        just_started <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elseif</span> v_tmp <span class="op">&gt;</span> vmax </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">end</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>            v1[i] <span class="op">=</span> vmax <span class="co">#update maximized value</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>            pol[i] <span class="op">=</span> pol_i <span class="co">#update policy function</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> distance <span class="op">&lt;</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i])</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>                distance <span class="op">=</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i]) <span class="co">#update distance</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>        (distance <span class="op">&lt;</span> tol <span class="op">||</span> iterate <span class="op">==</span> <span class="fl">1000</span>) <span class="op">&amp;&amp;</span> <span class="cf">break</span> <span class="co"># break out the whole loop if one of the statements are true</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>        iterate <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>        v<span class="op">.=</span> v1<span class="co"># update the value, equivalently v = copy(v1)</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v<span class="op">=</span>v, pol<span class="op">=</span>pol, iterate<span class="op">=</span>iterate)</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>VFI_baseline_v2 (generic function with 1 method)</code></pre>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(v, pol, iterate) <span class="op">=</span>  <span class="fu">VFI_baseline_v2</span>(σ, β, A, α, δ, <span class="fl">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-141.6000605365398, -13.982081957061373, -11.222006674686714, -9.97467946907761, -9.194802019095095, -8.641506656983273, -8.23605937587854, -7.9187196210739685, -7.662167409250431, -7.446410754534364  …  -4.775705127339619, -4.7678914912950106, -4.760029024037419, -4.752245655402492, -4.744586503571926, -4.736843187659619, -4.7292611942669005, -4.721836140169183, -4.714354354769835, -4.707224761555834], pol = [1, 3, 4, 5, 6, 8, 9, 10, 11, 12  …  68, 68, 69, 70, 71, 71, 72, 72, 73, 73], iterate = 157)</code></pre>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">"The value function converged in </span><span class="sc">$</span>iterate<span class="st"> loops"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The value function converged in 157 loops</code></pre>
</div>
</div>
<p>We can do even better. Functions in Julia allow pre-specified values for some inputs (it uses the default value unless otherwise specified). Note that not only we can pre-specify parameters, but we can also pre-specify the grids (vectors).Note that this only helps to make the code look nicer and you don’t need to carry around something you don’t change a lot.</p>
<div id="cell-31" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VFI (Acceptable practice)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VFI_baseline_v3</span>(σ, β, A, α, δ; N <span class="op">=</span> <span class="fl">100</span>, tol <span class="op">=</span> <span class="fl">1e-6</span> , v <span class="op">=</span> <span class="fu">zeros</span>(N), k <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0.01</span>, (A <span class="op">/</span> δ)<span class="op">^</span>(<span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> α)), N))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    pol <span class="op">=</span> <span class="fu">similar</span>(v, <span class="dt">Int</span>) <span class="co"># will be used for storing the policy function (k'), as an index</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for storing updated value function</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    iterate <span class="op">=</span> <span class="fl">0</span> <span class="co"># keep track of how many iterations we have run</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="cn">true</span> <span class="co"># the code keeps iterating itself until we manually break it</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used to keep track of the difference between v and Tv</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># outer loop over each grid of v</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(v) <span class="co"># iterate over value function</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>            pol_i <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>            just_started <span class="op">=</span> <span class="cn">true</span>  <span class="co"># will be used later to store v with choosing k'= 0</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            vmax <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used later to store the maximized v</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># most inner loop over potential k'</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="fu">eachindex</span>(k) </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> <span class="fu">F</span>(k[i]) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> δ) <span class="op">*</span> k[i] <span class="op">-</span> k[j] <span class="co"># this is the consumption if we choose k' = k[j]</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;=</span> <span class="fl">0.0</span> <span class="co"># make sure consumption is nonnegative</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>                    v_tmp <span class="op">=</span> <span class="fu">u</span>(c) <span class="op">+</span> β <span class="op">*</span> v[j] <span class="co">#v if choosing k' = k[j]</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> just_started <span class="co"># logic operation </span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp <span class="co"># store the value function</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j <span class="co"># store the policy function (an index on k)</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>                        just_started <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elseif</span> v_tmp <span class="op">&gt;</span> vmax </span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">end</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>            v1[i] <span class="op">=</span> vmax <span class="co">#update maximized value</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>            pol[i] <span class="op">=</span> pol_i <span class="co">#update policy function</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> distance <span class="op">&lt;</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i])</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>                distance <span class="op">=</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i]) <span class="co">#update distance</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>        (distance <span class="op">&lt;</span> tol <span class="op">||</span> iterate <span class="op">==</span> <span class="fl">1000</span>) <span class="op">&amp;&amp;</span> <span class="cf">break</span> <span class="co"># break out the whole loop if one of the statements are true</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>        iterate <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>        v<span class="op">.=</span> v1<span class="co"># update the value, equivalently v = copy(v1)</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v<span class="op">=</span>v, pol<span class="op">=</span>pol, iterate<span class="op">=</span>iterate)</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>VFI_baseline_v3 (generic function with 1 method)</code></pre>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VFI_baseline_v3</span>(σ, β, A, α, δ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-141.6000605365398, -13.982081957061373, -11.222006674686714, -9.97467946907761, -9.194802019095095, -8.641506656983273, -8.23605937587854, -7.9187196210739685, -7.662167409250431, -7.446410754534364  …  -4.775705127339619, -4.7678914912950106, -4.760029024037419, -4.752245655402492, -4.744586503571926, -4.736843187659619, -4.7292611942669005, -4.721836140169183, -4.714354354769835, -4.707224761555834], pol = [1, 3, 4, 5, 6, 8, 9, 10, 11, 12  …  68, 68, 69, 70, 71, 71, 72, 72, 73, 73], iterate = 157)</code></pre>
</div>
</div>
<p>One more slight modification is to use struct. If you have experience with c++, this basically works in the same way as classes in c++.</p>
<div id="cell-34" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="pp">@kwdef</span> <span class="kw">struct</span> Household <span class="co"># or simply @kwdef</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">::</span><span class="dt"> Float64 </span><span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    β <span class="op">::</span><span class="dt"> Float64 </span><span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    A <span class="op">::</span><span class="dt"> Float64 </span><span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    α <span class="op">::</span><span class="dt"> Float64 </span><span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    δ <span class="op">::</span><span class="dt"> Float64 </span><span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="fu">Household</span>() </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># to modify some of the inputs, say σ to 4.0, simply let h = Household(σ = 4.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Household(2.0, 0.9, 2.0, 0.7, 0.9)</code></pre>
</div>
</div>
<p>First, we need to make some slight modifications on the function for utility and production so that it works with our struct. Here, <code>m</code> refers to the struct and <code>m.</code> refers to whatever parameter in m.</p>
<div id="cell-36" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">u1</span>(c, m) <span class="op">=</span> c<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> m.σ)<span class="op">/</span>(<span class="fl">1</span> <span class="op">-</span> m.σ)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">F1</span>(k, m) <span class="op">=</span> m.A <span class="op">*</span> k<span class="op">^</span>m.α</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>F1 (generic function with 1 method)</code></pre>
</div>
</div>
<p>Then, for VFI, we can suppress all inputs into one.</p>
<div id="cell-38" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VFI (Better practice)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VFI_baseline_v4</span>(h; N <span class="op">=</span> <span class="fl">100</span>, tol <span class="op">=</span> <span class="fl">1e-6</span> , v <span class="op">=</span> <span class="fu">zeros</span>(N), k <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0.01</span>, (h.A <span class="op">/</span> h.δ)<span class="op">^</span>(<span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> h.α)), N))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    pol <span class="op">=</span> <span class="fu">similar</span>(v, <span class="dt">Int</span>) <span class="co"># will be used for storing the policy function (k'), as an index</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for storing updated value function</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    iterate <span class="op">=</span> <span class="fl">0</span> <span class="co"># keep track of how many iterations we have run</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="cn">true</span> <span class="co"># the code keeps iterating itself until we manually break it</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used to keep track of the difference between v and Tv</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># outer loop over each grid of v</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(v) <span class="co"># iterate over value function</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>            pol_i <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>            just_started <span class="op">=</span> <span class="cn">true</span>  <span class="co"># will be used later to store v with choosing k'= 0</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>            vmax <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used later to store the maximized v</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># most inner loop over potential k'</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="fu">eachindex</span>(k) </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> <span class="fu">F1</span>(k[i], h) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> h.δ) <span class="op">*</span> k[i] <span class="op">-</span> k[j] <span class="co"># this is the consumption if we choose k' = k[j]</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;=</span> <span class="fl">0.0</span> <span class="co"># make sure consumption is nonnegative</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>                    v_tmp <span class="op">=</span> <span class="fu">u1</span>(c,h) <span class="op">+</span> h.β <span class="op">*</span> v[j] <span class="co">#v if choosing k' = k[j]</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> just_started <span class="co"># logic operation </span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp <span class="co"># store the value function</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j <span class="co"># store the policy function (an index on k)</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>                        just_started <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elseif</span> v_tmp <span class="op">&gt;</span> vmax </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">end</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>            v1[i] <span class="op">=</span> vmax <span class="co">#update maximized value</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>            pol[i] <span class="op">=</span> pol_i <span class="co">#update policy function</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> distance <span class="op">&lt;</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i])</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>                distance <span class="op">=</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i]) <span class="co">#update distance</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>        (distance <span class="op">&lt;</span> tol <span class="op">||</span> iterate <span class="op">==</span> <span class="fl">1000</span>) <span class="op">&amp;&amp;</span> <span class="cf">break</span> <span class="co"># break out the whole loop if one of the statements are true</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>        iterate <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>        v<span class="op">.=</span> v1<span class="co"># update the value, equivalently v = copy(v1)</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v<span class="op">=</span>v, pol<span class="op">=</span>pol, iterate<span class="op">=</span>iterate)</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>VFI_baseline_v4 (generic function with 1 method)</code></pre>
</div>
</div>
<div id="cell-39" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VFI_baseline_v4</span>(h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-141.6000605365398, -13.982081957061373, -11.222006674686714, -9.97467946907761, -9.194802019095095, -8.641506656983273, -8.23605937587854, -7.9187196210739685, -7.662167409250431, -7.446410754534364  …  -4.775705127339619, -4.7678914912950106, -4.760029024037419, -4.752245655402492, -4.744586503571926, -4.736843187659619, -4.7292611942669005, -4.721836140169183, -4.714354354769835, -4.707224761555834], pol = [1, 3, 4, 5, 6, 8, 9, 10, 11, 12  …  68, 68, 69, 70, 71, 71, 72, 72, 73, 73], iterate = 157)</code></pre>
</div>
</div>
<p>There are many advantages with using struct:</p>
<ul>
<li>It is very clean.</li>
<li>There are no global variables stored. Using local variables whenever possible prevents you away from a lot of mistakes and bugs.</li>
<li>Using struct keeps the input intact. A typical thing that happens when working with a big project is that we often need to modify the inputs to some functions we wrote (say we want to also include a tax on capital rental income). If you applied this functions around in your code, with struct you don’t need to modify every single one of them.</li>
<li>It avoids some often unnoticed mistakes like messing up the order of your inputs.</li>
<li>It is easy to modify (as the comment before).</li>
</ul>
<p>One potential disadvantage is that it is slightly slower (really small difference), but most of the time this tiny difference of speed doesn’t matter.</p>
</section>
<section id="improving-the-code-towards-speed" class="level5">
<h5 class="anchored" data-anchor-id="improving-the-code-towards-speed">2.3.3 Improving the code towards speed</h5>
<p>For the purpose of the code, it is already fast enough so we don’t really have incentive to make adjustments for speed. However, for projects that are more computationally heavy, this section is to give a glimpse for the potential ways to boost efficiency of the code.</p>
<p>Piece of advice to keep in mind: a large fractions of tricks or methodologies to increase speed are at the cost of the clarity of the code. The golden rule is to only consider speed up to the point you need for the particular project. Correctness and clarity are always of greater priority.</p>
<p>Here I introduce two tricks that provides significant gain in speed and still preserves the clarity in code. To make comparisons between the original code, from now on I make the number of grids N bigger (1000).</p>
<div id="cell-42" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># speed of the original code</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="cf">begin</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Speed of the original code</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    v4, <span class="op">=</span> <span class="fu">VFI_baseline_v4</span>(h; N<span class="op">=</span> <span class="fl">1000</span>) <span class="co">#Only get out v</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  3.473902 seconds (5.58 k allocations: 406.332 KiB, 0.17% compilation time)</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-43.72028630185341, -28.841363390515816, -23.574176627043187, -20.68493421026871, -18.811137873668766, -17.470185034668205, -16.429607986655366, -15.615620425521886, -14.936554411075287, -14.374732380493473  …  -4.711108839962214, -4.710391274429081, -4.709675908528837, -4.708961199547117, -4.708246173882994, -4.707531410095677, -4.706818288630849, -4.706109231525942, -4.705398964856121, -4.704688876268555], pol = [2, 4, 6, 8, 10, 11, 13, 15, 16, 18  …  727, 727, 728, 728, 729, 730, 730, 730, 731, 732], iterate = 128)</code></pre>
</div>
</div>
</section>
<section id="a-trick-within-the-loop" class="level5">
<h5 class="anchored" data-anchor-id="a-trick-within-the-loop">2.3.3.1 A trick within the loop</h5>
<p>Here comes the magic. Try to find the difference between the codes (v5 and v4) by yourself.</p>
<div id="cell-45" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VFI (Better practice)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VFI_baseline_v5</span>(h; N <span class="op">=</span> <span class="fl">100</span>, tol <span class="op">=</span> <span class="fl">1e-6</span> , v <span class="op">=</span> <span class="fu">zeros</span>(N), k <span class="op">=</span> <span class="fu">range</span>(<span class="fl">0.01</span>, (h.A <span class="op">/</span> h.δ)<span class="op">^</span>(<span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> h.α)), N))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    pol <span class="op">=</span> <span class="fu">similar</span>(v, <span class="dt">Int</span>) <span class="co"># will be used for storing the policy function (k'), as an index</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for storing updated value function</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    iterate <span class="op">=</span> <span class="fl">0</span> <span class="co"># keep track of how many iterations we have run</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="cn">true</span> <span class="co"># the code keeps iterating itself until we manually break it</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used to keep track of the difference between v and Tv</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        pol_i <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># outer loop over each grid of v</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(v) <span class="co"># iterate over value function</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>            just_started <span class="op">=</span> <span class="cn">true</span>  <span class="co"># will be used later to store v with choosing k'= 0</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>            vmax <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used later to store the maximized v</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># most inner loop over potential k'</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">###################### Here ###########################</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> pol_i<span class="op">:</span>N  </span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">###################### Here ###########################</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> <span class="fu">F1</span>(k[i], h) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> h.δ) <span class="op">*</span> k[i] <span class="op">-</span> k[j] <span class="co"># this is the consumption if we choose k' = k[j]</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;=</span> <span class="fl">0.0</span> <span class="co"># make sure consumption is nonnegative</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                    v_tmp <span class="op">=</span> <span class="fu">u1</span>(c,h) <span class="op">+</span> h.β <span class="op">*</span> v[j] <span class="co">#v if choosing k' = k[j]</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> just_started <span class="co"># logic operation </span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp <span class="co"># store the value function</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j <span class="co"># store the policy function (an index on k)</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>                        just_started <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elseif</span> v_tmp <span class="op">&gt;</span> vmax </span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>                        pol_i <span class="op">=</span> j</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>                        vmax <span class="op">=</span> v_tmp</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>                    <span class="co">###################### Here ###########################</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span> <span class="co">#only break out of the most inner loop</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">end</span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>                    <span class="co">###################### Here ###########################</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>            v1[i] <span class="op">=</span> vmax <span class="co">#update maximized value</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>            pol[i] <span class="op">=</span> pol_i <span class="co">#update policy function</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> distance <span class="op">&lt;</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i])</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>                distance <span class="op">=</span> <span class="fu">abs</span>(vmax <span class="op">-</span> v[i]) <span class="co">#update distance</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>        (distance <span class="op">&lt;</span> tol <span class="op">||</span> iterate <span class="op">==</span> <span class="fl">1000</span>) <span class="op">&amp;&amp;</span> <span class="cf">break</span> <span class="co"># break out the whole loop if one of the statements are true</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>        iterate <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>        v<span class="op">.=</span> v1<span class="co"># update the value, equivalently v = copy(v1)</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v<span class="op">=</span>v, pol<span class="op">=</span>pol, iterate<span class="op">=</span>iterate)</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>VFI_baseline_v5 (generic function with 1 method)</code></pre>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="cf">begin</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    v5, <span class="op">=</span> <span class="fu">VFI_baseline_v5</span>(h; N<span class="op">=</span> <span class="fl">1000</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  0.044231 seconds (24.71 k allocations: 1.622 MiB, 73.82% compilation time)</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-43.72028630185341, -28.841363390515816, -23.574176627043187, -20.68493421026871, -18.811137873668766, -17.470185034668205, -16.429607986655366, -15.615620425521886, -14.936554411075287, -14.374732380493473  …  -4.711108839962214, -4.710391274429081, -4.709675908528837, -4.708961199547117, -4.708246173882994, -4.707531410095677, -4.706818288630849, -4.706109231525942, -4.705398964856121, -4.704688876268555], pol = [2, 4, 6, 8, 10, 11, 13, 15, 16, 18  …  727, 727, 728, 728, 729, 730, 730, 730, 731, 732], iterate = 128)</code></pre>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that they do yield same value function (use approximately equal as floats can sometimes have some random minor differences)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>v4 <span class="op">≈</span> v5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>true</code></pre>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the time difference</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.478666</span><span class="op">/</span><span class="fl">0.044231</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>33.43053514503403</code></pre>
</div>
</div>
<p>The code is absurdly 33 times faster (would be even larger difference if N is larger).</p>
<p>What happened?</p>
<p><strong><em>First modification:</em></strong> Note that before when I was iterating k’ I used</p>
<p><code>for j in eachindex(k)</code>,</p>
<p>which, in this environment is equivalent to</p>
<p><code>for j in 1:N</code>.</p>
<p>However, now the code writes</p>
<p><code>for j in pol_i:N</code>.</p>
<p>Instead of the beginning, I start from the policy function of the last i. Why doing this still yield the same result? It is due to strictly increasing policy function. If <span class="math inline">\(g(k[i]) = k\)</span>[pol_i], then <span class="math inline">\(g(k[i + 1]) ≥  k\)</span>[pol_i], so we can start from the previous policy. This is a huge gain of efficiency.</p>
<p><strong><em>Second modification:</em></strong></p>
<p>From the graph of the value function, you see that it is strictly concave in <span class="math inline">\(k\)</span>. This means that when I update my guess of <span class="math inline">\(V(k)\)</span> when searching monotonically along <span class="math inline">\(k'\)</span>, I can stop when the RHS of Bellman equation starts dropping.</p>
<p>This is what</p>
<p><code>else \\ break #only break out of the most inner loop end</code></p>
<p>does.</p>
</section>
<section id="vectorization" class="level4">
<h4 class="anchored" data-anchor-id="vectorization">2.4 Vectorization</h4>
<p>Julia is a language written in vector operations. Vectorization is in a lot of cases preferred for efficiency. For most dynamic programming problems with uncertainties (we will see in next couple lectures), vectorization is desirable and should be how the code will look like in the end. However in our simple example here, as you will see, without modifications, vectorization performs worse than loops, but it is a useful tool that one should keep in mind.</p>
<p>Why don’t we always start with vectorization? Vectorization requires full restructuring of the algorithm and in most cases is more elegant but less straightforward than simple loops. Remember that a nice-looking but wrong code has zero value. Thus, in practice, you should start with the loop version (as we did) and make sure you fully understand it, before going to vectorization.</p>
<p>For the purpose here, let’s do step by step. First, we will vectorize the inner loop. That is, fix k and find k’ that maximize the RHS of the Bellman equation.</p>
<div id="cell-51" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="vectorizing-the-inner-loop" class="level5">
<h5 class="anchored" data-anchor-id="vectorizing-the-inner-loop">2.4.1 Vectorizing the inner loop</h5>
</section>
<section id="quick-introduction-to-broadcasting" class="level5">
<h5 class="anchored" data-anchor-id="quick-introduction-to-broadcasting">2.4.1.1 Quick introduction to broadcasting</h5>
<p>In Julia, the tool that comes very handy for vectorization is the simple “.”. The dot broadcasts the operation you want to perform on each element of an array (or a matrix). Say x is an array and you want to add 2 to every element of x. You probably want to do the following:</p>
<div id="cell-53" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="fl">2</span>, <span class="fl">2</span>] <span class="co">#some random array</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">+</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>MethodError: MethodError: no method matching +(::Vector{Int64}, ::Int64)
For element-wise addition, use broadcasting with dot syntax: array .+ scalar

Closest candidates are:
  +(::Any, ::Any, !Matched::Any, !Matched::Any...)
   @ Base operators.jl:578
  +(!Matched::T, ::T) where T&lt;:Union{Int128, Int16, Int32, Int64, Int8, UInt128, UInt16, UInt32, UInt64, UInt8}
   @ Base int.jl:87
  +(!Matched::Rational, ::Integer)
   @ Base rational.jl:327
  ...</code></pre>
</div>
</div>
<p>An error message arises and it is kind enough to remind you that you should instead do this:</p>
<div id="cell-55" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="fl">2</span>, <span class="fl">2</span>] <span class="co">#some random array</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">.+</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>2-element Vector{Int64}:
 4
 4</code></pre>
</div>
</div>
<p>which gives the correct result. The takeaway is to always use “.” for any elementwise operation.</p>
<p>An exception is for multipilcations. We can perform elementwise multipilcation without specification, i.e.</p>
<div id="cell-57" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> [<span class="fl">2</span>, <span class="fl">2</span>] <span class="co">#some random array</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fl">2</span> <span class="op">*</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>2-element Vector{Int64}:
 4
 4</code></pre>
</div>
</div>
<p>Note that it also works with functions. f.(x) broadcasts f onto an array x.</p>
<div id="cell-59" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(y) <span class="op">=</span> <span class="fl">3</span><span class="op">*</span>y</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>.(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>2-element Vector{Int64}:
 6
 6</code></pre>
</div>
</div>
<p>Here we want to broadcast utility function onto all nonnegative consumptions. Note that <code>u1(c, m) = c^(1 - m.σ)/(1 - m.σ)</code>. With the first entry being the array that we want to broadcast on, we want to fix the second entry m so that the broadcast is correct.</p>
<p>The code we need to use is then <code>u1.(c[mask], Ref(h))</code> instead of <code>u1.(c[mask], h)</code>, where the <code>Ref(h)</code> syntax is used to create a reference to the h struct, which allows us to broadcast the function properly.</p>
</section>
<section id="back-to-business" class="level5">
<h5 class="anchored" data-anchor-id="back-to-business">2.4.1.2 Back to business</h5>
<p>One more thing to note is that v_tmp is now an array. I initialize it to be -Inf and only change the entries with positive consumptions. This guarantees that our optimization is correct.</p>
<p>Now I provide the code for vectorization of the inner loop. Note that we can no longer apply the trick as before because with every k, we will have a different dimension of k’, which will break the vectorization.</p>
<div id="cell-61" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VFI (Partially vectorized version)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VFI_baseline_vectorized</span>(h; N<span class="op">=</span><span class="fl">100</span>, tol<span class="op">=</span><span class="fl">1e-6</span>, v<span class="op">=</span><span class="fu">zeros</span>(N), k<span class="op">=</span><span class="fu">range</span>(<span class="fl">0.01</span>, (h.A <span class="op">/</span> h.δ)<span class="op">^</span>(<span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> h.α)), N))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    pol <span class="op">=</span> <span class="fu">similar</span>(v, <span class="dt">Int</span>) <span class="co"># will be used for storing the policy function (k'), as an index</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for storing updated value function</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    iterate <span class="op">=</span> <span class="fl">0</span> <span class="co"># keep track of how many iterations we have run</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    v_tmp <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for calculating maximized value function for each i</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># preallocate space for c</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="fu">similar</span>(c, <span class="dt">Int</span>) <span class="co"># preallocate space for the indicator for non-negativity</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="cn">true</span> <span class="co"># the code keeps iterating itself until we manually break it</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used to keep track of the difference between v and Tv</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># outer loop over each grid of v</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(v) <span class="co"># iterate over value function</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>            pol_i <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>            vmax <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used later to store the maximized v</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># calculate consumption and value for all potential k' simultaneously</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> <span class="fu">F1</span>(k[i], h) <span class="op">.+</span> (<span class="fl">1</span> <span class="op">-</span> h.δ) <span class="op">*</span> k[i] <span class="op">.-</span> k <span class="co"># consumption for all potential k'</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>            mask <span class="op">=</span> (c <span class="op">.&gt;=</span> <span class="fl">0.0</span>) <span class="co"># create an index for nonnegative consumptions</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate temporary value for all potential k' simultaneously</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>            v_tmp <span class="op">.=</span> <span class="op">-</span><span class="cn">Inf</span> <span class="co"># Initialize v_tmp with -Inf for all elements</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>            v_tmp[mask] <span class="op">.=</span> <span class="fu">u1</span>.(c[mask], <span class="fu">Ref</span>(h)) <span class="op">.+</span> h.β <span class="op">.*</span> v[mask] <span class="co"># Assign temporary value for elements with positive consumption</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find the maximum value and corresponding policy index</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>            vmax, pol_i <span class="op">=</span> <span class="fu">findmax</span>(v_tmp, dims<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Update v1 and pol arrays using the maximum value and policy index</span></span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>            v1[i] <span class="op">=</span> vmax[<span class="fl">1</span>]</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>            pol[i] <span class="op">=</span> pol_i[<span class="fl">1</span>]</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> distance <span class="op">&lt;</span> <span class="fu">abs</span>(vmax[<span class="fl">1</span>] <span class="op">-</span> v[i])</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>                distance <span class="op">=</span> <span class="fu">abs</span>(vmax[<span class="fl">1</span>] <span class="op">-</span> v[i]) <span class="co"># update distance</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>        (distance <span class="op">&lt;</span> tol <span class="op">||</span> iterate <span class="op">==</span> <span class="fl">1000</span>) <span class="op">&amp;&amp;</span> <span class="cf">break</span> <span class="co"># break out of the whole loop if one of the statements is true</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>        iterate <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>        v <span class="op">.=</span> v1 <span class="co"># update the value using element-wise assignment</span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v<span class="op">=</span>v, pol<span class="op">=</span>pol, iterate<span class="op">=</span>iterate)</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>VFI_baseline_vectorized (generic function with 1 method)</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="cf">begin</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    v6, <span class="op">=</span> <span class="fu">VFI_baseline_vectorized</span>(h; N <span class="op">=</span> <span class="fl">1000</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  1.680241 seconds (1.88 M allocations: 3.306 GiB, 16.46% gc time, 12.01% compilation time)</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-43.72028630185341, -28.841363390515816, -23.574176627043187, -20.68493421026871, -18.811137873668766, -17.470185034668205, -16.429607986655366, -15.615620425521886, -14.936554411075287, -14.374732380493473  …  -4.711108839962214, -4.710391274429081, -4.709675908528837, -4.708961199547117, -4.708246173882994, -4.707531410095677, -4.706818288630849, -4.706109231525942, -4.705398964856121, -4.704688876268555], pol = [2, 4, 6, 8, 10, 11, 13, 15, 16, 18  …  727, 727, 728, 728, 729, 730, 730, 730, 731, 732], iterate = 128)</code></pre>
</div>
</div>
<p>Check whether the result is correct.</p>
<div id="cell-64" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>v6 <span class="op">≈</span> v5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>true</code></pre>
</div>
</div>
</section>
<section id="fully-vectorized-vfi" class="level5">
<h5 class="anchored" data-anchor-id="fully-vectorized-vfi">2.4.2 Fully vectorized VFI</h5>
<p>If you are a “for loop” hater, then the following code will sing to you. It is very elegant and used a bunch of cool built-in functions along the way.</p>
<div id="cell-66" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VFI (Fully vectorized version)</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VFI_baseline_full_vec</span>(h; N<span class="op">=</span><span class="fl">100</span>, tol<span class="op">=</span><span class="fl">1e-6</span>, v<span class="op">=</span><span class="fu">zeros</span>(N), k<span class="op">=</span><span class="fu">range</span>(<span class="fl">0.01</span>, (h.A <span class="op">/</span> h.δ)<span class="op">^</span>(<span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> h.α)), N))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    pol <span class="op">=</span> <span class="fu">similar</span>(v, <span class="dt">Int</span>) <span class="co"># will be used for storing the policy function (k'), as an index</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for storing updated value function</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    iterate <span class="op">=</span> <span class="fl">0</span> <span class="co"># keep track of how many iterations we have run</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="fu">similar</span>(v, (N,N)) <span class="co"># preallocate space for c</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    v_tmp <span class="op">=</span> <span class="fu">similar</span>(c) <span class="co"># will be used for calculating maximized value function for all i</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="fu">similar</span>(c, <span class="dt">Int</span>) <span class="co"># preallocate space for the indicator for non-negativity</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="cn">true</span> <span class="co"># the code keeps iterating itself until we manually break it</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used to keep track of the difference between v and Tv</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate consumption and value for all combinations of k and k' simultaneously</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>        c <span class="op">=</span> <span class="fu">F1</span>.(k, <span class="fu">Ref</span>(h)) <span class="op">.+</span> (<span class="fl">1</span> <span class="op">-</span> h.δ) <span class="op">.*</span> k <span class="op">.-</span> k<span class="op">'</span> <span class="co"># consumption for all combinations of k and k'</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> (c <span class="op">.&gt;=</span> <span class="fl">0.0</span>) <span class="co"># create an index for nonnegative consumptions</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate temporary value for all combinations of k and k' simultaneously</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>        v_tmp <span class="op">.=</span> <span class="op">-</span><span class="cn">Inf</span> <span class="co"># Initialize v_tmp with -Inf for all elements</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>        v_tmp[mask] <span class="op">.=</span> <span class="fu">u1</span>.(c[mask], <span class="fu">Ref</span>(h)) <span class="op">.+</span> h.β <span class="op">.*</span> (<span class="fu">repeat</span>(v, outer <span class="op">=</span> [<span class="fl">1</span>,N]))<span class="ch">'[mask] # Assign temporary value for elements with positive consumption</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find the maximum value and corresponding policy index along rows</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>        vmax, pol_i <span class="op">=</span> <span class="fu">findmax</span>(v_tmp, dims<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update v1 and pol arrays using the maximum value and policy index</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>        v1 <span class="op">.=</span> vmax[<span class="op">:</span>, <span class="fl">1</span>]</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>        pol <span class="op">.=</span> <span class="fu">getindex</span>.(pol_i[<span class="op">:</span>, <span class="fl">1</span>], <span class="fl">2</span>)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">maximum</span>(<span class="fu">abs</span>.(vmax[<span class="op">:</span>, <span class="fl">1</span>] <span class="op">.-</span> v)) <span class="co"># update distance</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>        (distance <span class="op">&lt;</span> tol <span class="op">||</span> iterate <span class="op">==</span> <span class="fl">1000</span>) <span class="op">&amp;&amp;</span> <span class="cf">break</span> <span class="co"># break out of the whole loop if one of the statements is true</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>        iterate <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Vectorized update of v using element-wise assignment</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>        v <span class="op">.=</span> v1</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v<span class="op">=</span>v, pol<span class="op">=</span>pol, iterate<span class="op">=</span>iterate)</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>VFI_baseline_full_vec (generic function with 1 method)</code></pre>
</div>
</div>
<div id="cell-67" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="cf">begin</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    v7, <span class="op">=</span> <span class="fu">VFI_baseline_full_vec</span>(h; N<span class="op">=</span><span class="fl">1000</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  3.961815 seconds (1.59 M allocations: 3.741 GiB, 4.75% gc time, 11.66% compilation time)</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-43.72028630185341, -28.841363390515816, -23.574176627043187, -20.684934210268707, -18.811137873668766, -17.470185034668205, -16.429607986655366, -15.615620425521886, -14.936554411075287, -14.374732380493473  …  -4.711108839962214, -4.710391274429081, -4.709675908528837, -4.708961199547117, -4.708246173882994, -4.707531410095677, -4.706818288630849, -4.706109231525942, -4.705398964856121, -4.704688876268555], pol = [2, 4, 6, 8, 10, 11, 13, 15, 16, 18  …  727, 727, 728, 728, 729, 730, 730, 730, 731, 732], iterate = 128)</code></pre>
</div>
</div>
<p>Check if the result is correct.</p>
<div id="cell-69" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>v7 <span class="op">≈</span> v6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>true</code></pre>
</div>
</div>
</section>
<section id="why-in-this-case-vectorization-is-slightly-slower" class="level5">
<h5 class="anchored" data-anchor-id="why-in-this-case-vectorization-is-slightly-slower">2.4.3 Why in this case vectorization is slightly slower?</h5>
<p>Chat GPT has a wonderful explanation:</p>
<p>“The vectorized version of the code is slower compared to the original loop version for a few reasons:</p>
<ul>
<li><p>Memory usage: The vectorized version uses additional memory to store intermediate arrays, such as c and v_tmp, which can lead to increased memory usage and slower performance. This is especially true if the grid size N is large.</p></li>
<li><p>Array broadcasting: Broadcasting operations (.) in Julia can sometimes be less efficient compared to explicit loops, especially when dealing with large arrays. Broadcasting can result in unnecessary memory allocations and temporary arrays.</p></li>
<li><p>Cache efficiency: The vectorized version might not take advantage of CPU cache efficiency as effectively as the loop version. In the loop version, the calculations are done sequentially, which can utilize the CPU cache more efficiently. The vectorized version performs calculations across multiple elements simultaneously, which can lead to cache misses.”</p></li>
</ul>
<p>Another reason unmentioned by GPT is that loops on Julia are very fast if written properly. If you are solving the same problem with loops on Python, you will find it to be much slower than what we managed to do. On the other side, there are a lot that can be done to speed up the vectorized version of the code above. With appropriate adjustments, the code can have similar, if not better performance than the loop version, which is something to keep in mind for an actual project.</p>
<p>For example, there’s one trick we can apply on the last part. Note that we can pre-compute all consumption as for each k and k’, consumption are fixed. This can also be done with the loop version but is much more convenient with vectorized VFI.</p>
</section>
<section id="example-for-optimizing-vfi-with-vectorization" class="level5">
<h5 class="anchored" data-anchor-id="example-for-optimizing-vfi-with-vectorization">2.4.4 Example for optimizing VFI with vectorization</h5>
<p>This also works like magic. I just pulled a couple lines outside the loop but the efficiency rocketed.</p>
<div id="cell-71" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VFI (Fully vectorized version with c computed outside the loop)</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">VFI_baseline_full_vec_pre_c</span>(h; N<span class="op">=</span><span class="fl">100</span>, tol<span class="op">=</span><span class="fl">1e-6</span>, v<span class="op">=</span><span class="fu">zeros</span>(N), k<span class="op">=</span><span class="fu">range</span>(<span class="fl">0.01</span>, (h.A <span class="op">/</span> h.δ)<span class="op">^</span>(<span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> h.α)), N))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    pol <span class="op">=</span> <span class="fu">similar</span>(v, <span class="dt">Int</span>) <span class="co"># will be used for storing the policy function (k'), as an index</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> <span class="fu">similar</span>(v) <span class="co"># will be used for storing updated value function</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    iterate <span class="op">=</span> <span class="fl">0</span> <span class="co"># keep track of how many iterations we have run</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate consumption and value for all combinations of k and k' simultaneously</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="fu">F1</span>.(k, <span class="fu">Ref</span>(h)) <span class="op">.+</span> (<span class="fl">1</span> <span class="op">-</span> h.δ) <span class="op">.*</span> k <span class="op">.-</span> k<span class="op">'</span> <span class="co"># consumption for all combinations of k and k'</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> (c <span class="op">.&gt;=</span> <span class="fl">0.0</span>) <span class="co"># create an index for nonnegative consumptions</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    v_tmp <span class="op">=</span> <span class="fu">similar</span>(c) <span class="co"># will be used for calculating maximized value function for all i</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate temporary value for all combinations of k and k' simultaneously</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    v_tmp <span class="op">.=</span> <span class="op">-</span><span class="cn">Inf</span> <span class="co"># Initialize v_tmp with -Inf for all elements</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="cn">true</span> <span class="co"># the code keeps iterating itself until we manually break it</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(v)) <span class="co"># will be used to keep track of the difference between v and Tv</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>        v_tmp[mask] <span class="op">.=</span> <span class="fu">u1</span>.(c[mask], <span class="fu">Ref</span>(h)) <span class="op">.+</span> h.β <span class="op">.*</span> (<span class="fu">repeat</span>(v, outer <span class="op">=</span> [<span class="fl">1</span>,N]))<span class="ch">'[mask] # Assign temporary value for elements with positive consumption</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find the maximum value and corresponding policy index along rows</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>        vmax, pol_i <span class="op">=</span> <span class="fu">findmax</span>(v_tmp, dims<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update v1 and pol arrays using the maximum value and policy index</span></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>        v1 <span class="op">.=</span> vmax[<span class="op">:</span>, <span class="fl">1</span>]</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>        pol <span class="op">.=</span> <span class="fu">getindex</span>.(pol_i[<span class="op">:</span>, <span class="fl">1</span>], <span class="fl">2</span>)</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>        distance <span class="op">=</span> <span class="fu">maximum</span>(<span class="fu">abs</span>.(vmax[<span class="op">:</span>, <span class="fl">1</span>] <span class="op">.-</span> v)) <span class="co"># update distance</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>        (distance <span class="op">&lt;</span> tol <span class="op">||</span> iterate <span class="op">==</span> <span class="fl">1000</span>) <span class="op">&amp;&amp;</span> <span class="cf">break</span> <span class="co"># break out of the whole loop if one of the statements is true</span></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>        iterate <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update of v using element-wise assignment</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>        v <span class="op">.=</span> v1</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (v<span class="op">=</span>v, pol<span class="op">=</span>pol, iterate<span class="op">=</span>iterate)</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>VFI_baseline_full_vec_pre_c (generic function with 1 method)</code></pre>
</div>
</div>
<div id="cell-72" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="cf">begin</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    v8, <span class="op">=</span> <span class="fu">VFI_baseline_full_vec_pre_c</span>(h; N<span class="op">=</span><span class="fl">1000</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  1.423058 seconds (314.05 k allocations: 2.673 GiB, 10.39% gc time, 9.41% compilation time)</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>(v = [-43.72028630185341, -28.841363390515816, -23.574176627043187, -20.684934210268707, -18.811137873668766, -17.470185034668205, -16.429607986655366, -15.615620425521886, -14.936554411075287, -14.374732380493473  …  -4.711108839962214, -4.710391274429081, -4.709675908528837, -4.708961199547117, -4.708246173882994, -4.707531410095677, -4.706818288630849, -4.706109231525942, -4.705398964856121, -4.704688876268555], pol = [2, 4, 6, 8, 10, 11, 13, 15, 16, 18  …  727, 727, 728, 728, 729, 730, 730, 730, 731, 732], iterate = 128)</code></pre>
</div>
</div>
<div id="cell-73" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>v8 <span class="op">≈</span> v7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>true</code></pre>
</div>
</div>
<p>We basically got back to the speed using loops without applying the trick. Here since the original problem is rather simple, vectorization doesn’t seem to outperform simple loops, but there are many cases where vectorization can yield significantly better outcome and Julia is a wonderful tool to test out different methods.</p>
</section>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">2.5 Conclusion</h2>
<p>We have gone carefully through solving a very standard problem in Macroeconomics. The goal is to showcase how to perform basic value function iteration in Julia. We mainly talked through how to code the problem in loop version and vector version. Along the way, I showed some important features of Julia coding. Most importantly, loops, functions, struct, broadcasting and vector/matrix operations.</p>
<p>At last, we compared the performance of coding with loops and vectorizations. It might occur to you that loop version has better performance. Please keep in mind this varies in different problems and it is useful to know both methodologies.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>